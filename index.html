<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cálculos de Izaje - Minería Norte Chile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #333;
        }

        .header-bar {
            background: linear-gradient(135deg, #d4351c 0%, #aa2317 100%);
            color: white;
            padding: 5px 0;
            text-align: center;
            font-size: 0.9em;
            font-weight: 600;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px 40px;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #f39c12, #e74c3c, #9b59b6, #3498db);
        }

        .header-content {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            gap: 30px;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .certification-badge {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            min-width: 200px;
        }

        .certification-badge .cert-title {
            font-size: 0.8em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .certification-badge .cert-main {
            font-size: 1.1em;
            font-weight: 700;
        }

        .tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            padding: 16px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s ease;
            text-align: center;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            background: white;
            color: #2c3e50;
            border-bottom-color: #e74c3c;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .content {
            padding: 35px 40px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .section-icon {
            font-size: 2.5em;
            margin-right: 15px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-title {
            font-size: 1.8em;
            font-weight: 700;
            color: #2c3e50;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 14px 35px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 10px 10px 0;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
        }

        .btn-export {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .result-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #e74c3c;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .result-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .result-item {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .result-label {
            font-size: 0.9em;
            color: #7f8c8d;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 1.4em;
            font-weight: 700;
            color: #2c3e50;
        }

        .result-unit {
            font-size: 0.9em;
            color: #95a5a6;
            margin-left: 5px;
        }

        .alert {
            padding: 18px 25px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .alert-icon {
            font-size: 1.5em;
        }

        .reference-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .reference-table th {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .reference-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
            background: white;
        }

        .reference-table tr:nth-child(even) td {
            background: #f8f9fa;
        }

        .standards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .standard-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .standard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .standard-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #e74c3c;
        }

        .calculation-steps {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .step {
            margin-bottom: 15px;
            padding: 10px 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }

        .step-number {
            font-weight: 700;
            color: #e74c3c;
            margin-right: 10px;
        }

        .formula {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            text-align: center;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .header-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .content {
                padding: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        SISTEMA CERTIFICADO PARA OPERACIONES MINERAS - CUMPLE NORMATIVAS DS 132 Y ANSI/ASME B30
    </div>

    <div class="container">
        <div class="header">
            <div class="header-content">
                <div>
                    <h1>⛏️ Sistema de Cálculos de Izaje</h1>
                    <p>Minería Norte de Chile - Análisis Profesional de Operaciones de Carga</p>
                    <p>Versión 2.1 | Actualizado según normativas internacionales</p>
                </div>
                <div class="certification-badge">
                    <div class="cert-title">CERTIFICADO</div>
                    <div class="cert-main">ISO 9001:2015</div>
                    <div class="cert-title">Estándares Mineros</div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('crane-analysis')">Análisis de Grúa</button>
            <button class="tab" onclick="showTab('sling-engineering')">Ingeniería de Eslingas</button>
            <button class="tab" onclick="showTab('structural-analysis')">Centro de Gravedad</button>
            <button class="tab" onclick="showTab('stability')">Estabilidad y Momento</button>
            <button class="tab" onclick="showTab('standards')">Normativas y Estándares</button>
            <button class="tab" onclick="showTab('reports')">Reportes Técnicos</button>
        </div>

        <div class="content">
            <!-- Análisis de Grúa -->
            <div id="crane-analysis" class="tab-content active">
                <div class="section-header">
                    <div class="section-icon">🏗️</div>
                    <div class="section-title">Análisis Completo de Capacidad de Grúa</div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Tipo de Grúa:</label>
                        <select id="craneType">
                            <option value="mobile">Grúa Móvil Telescópica</option>
                            <option value="tower">Grúa Torre</option>
                            <option value="crawler">Grúa Sobre Orugas</option>
                            <option value="overhead">Puente Grúa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Peso de Carga (kg):</label>
                        <input type="number" id="craneLoadWeight" placeholder="ej: 15000">
                    </div>
                    <div class="form-group">
                        <label>Radio de Operación (m):</label>
                        <input type="number" id="craneRadius" placeholder="ej: 18.5">
                    </div>
                    <div class="form-group">
                        <label>Altura de Izaje (m):</label>
                        <input type="number" id="liftHeight" placeholder="ej: 25">
                    </div>
                    <div class="form-group">
                        <label>Capacidad Nominal Grúa (kg):</label>
                        <input type="number" id="craneCapacityNominal" placeholder="ej: 80000">
                    </div>
                    <div class="form-group">
                        <label>Condiciones Ambientales:</label>
                        <select id="weatherConditions">
                            <option value="normal">Normales (< 20 km/h viento)</option>
                            <option value="moderate">Moderadas (20-40 km/h viento)</option>
                            <option value="severe">Severas (> 40 km/h viento)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Factor de Seguridad:</label>
                        <select id="craneSafetyFactor">
                            <option value="1.25">1.25 (Operación estándar)</option>
                            <option value="1.5" selected>1.5 (Recomendado minería)</option>
                            <option value="2.0">2.0 (Operación crítica)</option>
                            <option value="2.5">2.5 (Máxima seguridad)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Operación:</label>
                        <select id="operationType">
                            <option value="standard">Estándar</option>
                            <option value="precision">Precisión</option>
                            <option value="heavy">Carga Pesada</option>
                            <option value="critical">Crítica</option>
                        </select>
                    </div>
                </div>

                <button class="btn" onclick="calculateCraneAnalysis()">Realizar Análisis Completo</button>
                <button class="btn btn-secondary" onclick="clearCraneInputs()">Limpiar Datos</button>

                <div id="craneAnalysisResult"></div>
            </div>

            <!-- Ingeniería de Eslingas -->
            <div id="sling-engineering" class="tab-content">
                <div class="section-header">
                    <div class="section-icon">🔗</div>
                    <div class="section-title">Ingeniería Avanzada de Eslingas</div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Peso Total de Carga (kg):</label>
                        <input type="number" id="slingLoadWeight" placeholder="ej: 12000">
                    </div>
                    <div class="form-group">
                        <label>Número de Ramales:</label>
                        <select id="slingLegsCount">
                            <option value="1">1 Ramal (Vertical)</option>
                            <option value="2" selected>2 Ramales</option>
                            <option value="3">3 Ramales</option>
                            <option value="4">4 Ramales</option>
                            <option value="6">6 Ramales</option>
                            <option value="8">8 Ramales</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ángulo de Eslinga (grados):</label>
                        <input type="number" id="slingAngleInput" value="60" min="15" max="90" placeholder="30-90°">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Material de Eslinga:</label>
                        <select id="slingMaterial">
                            <option value="steel">Cable de Acero (6x19)</option>
                            <option value="synthetic">Sintética Poliéster</option>
                            <option value="chain">Cadena Grado 8</option>
                            <option value="wire-rope">Cable Galvanizado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Diámetro de Eslinga (mm):</label>
                        <input type="number" id="slingDiameter" placeholder="ej: 16">
                    </div>
                    <div class="form-group">
                        <label>Factor de Seguridad:</label>
                        <select id="slingSafetyFactor">
                            <option value="5">5:1 (Mínimo aceptable)</option>
                            <option value="6" selected>6:1 (Estándar minería)</option>
                            <option value="8">8:1 (Alta criticidad)</option>
                            <option value="10">10:1 (Máxima seguridad)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Condición de Uso:</label>
                        <select id="slingCondition">
                            <option value="new">Nueva (100%)</option>
                            <option value="good" selected>Buena (85%)</option>
                            <option value="fair">Regular (75%)</option>
                            <option value="poor">Desgastada (65%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperatura de Trabajo (°C):</label>
                        <input type="number" id="workingTemp" value="20" placeholder="-40 a 200">
                    </div>
                </div>

                <button class="btn" onclick="calculateSlingEngineering()">Calcular Ingeniería de Eslingas</button>
                <button class="btn btn-secondary" onclick="generateSlingReport()">Generar Reporte</button>

                <div id="slingEngineeringResult"></div>
            </div>

            <!-- Análisis Estructural -->
            <div id="structural-analysis" class="tab-content">
                <div class="section-header">
                    <div class="section-icon">⚖️</div>
                    <div class="section-title">Centro de Gravedad y Análisis Estructural</div>
                </div>

                <div class="alert alert-warning">
                    <span class="alert-icon">📐</span>
                    <div>
                        <strong>CÁLCULO DE CENTRO DE GRAVEDAD PROFESIONAL</strong><br>
                        Determina el punto de equilibrio exacto para operaciones de izaje seguras según normativas mineras.
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Longitud Total de Pieza (m):</label>
                        <input type="number" id="structuralLength" placeholder="ej: 15.5">
                    </div>
                    <div class="form-group">
                        <label>Peso Total (kg):</label>
                        <input type="number" id="structuralWeight" placeholder="ej: 8500">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Estructura:</label>
                        <select id="structureType">
                            <option value="beam">Viga Uniforme</option>
                            <option value="truss">Estructura Reticulada</option>
                            <option value="equipment">Equipo Industrial</option>
                            <option value="module">Módulo de Planta</option>
                            <option value="pipe">Tubería/Cañería</option>
                            <option value="tank">Estanque/Tanque</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Material Principal:</label>
                        <select id="structureMaterial">
                            <option value="steel">Acero Estructural (7850 kg/m³)</option>
                            <option value="concrete">Hormigón Armado (2400 kg/m³)</option>
                            <option value="aluminum">Aluminio (2700 kg/m³)</option>
                            <option value="composite">Material Compuesto</option>
                        </select>
                    </div>
                </div>

                <h3>🎯 Cálculo Rápido de Centro de Gravedad</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Para Viga Uniforme - Centro automático:</label>
                        <button class="btn btn-secondary" onclick="calculateUniformBeam()">Calcular CG Uniforme</button>
                    </div>
                    <div class="form-group">
                        <label>Distancia del CG desde extremo izquierdo (m):</label>
                        <input type="number" id="manualCG" placeholder="Si conoce el CG exacto">
                    </div>
                </div>

                <h3>Cargas Concentradas</h3>
                <div id="concentratedLoads">
                    <div class="form-grid load-point">
                        <div class="form-group">
                            <label>Posición desde extremo izquierdo (m):</label>
                            <input type="number" class="load-position" placeholder="ej: 3.5">
                        </div>
                        <div class="form-group">
                            <label>Peso concentrado (kg):</label>
                            <input type="number" class="load-weight" placeholder="ej: 1200">
                        </div>
                        <div class="form-group">
                            <label>Descripción:</label>
                            <input type="text" class="load-description" placeholder="ej: Motor principal">
                        </div>
                    </div>
                </div>

                <button class="btn btn-secondary" onclick="addConcentratedLoad()">Agregar Carga Concentrada</button>
                <button class="btn" onclick="calculateStructuralAnalysis()">Analizar Estructura</button>

                <div id="structuralAnalysisResult"></div>
            </div>

            <!-- Estabilidad y Momento -->
            <div id="stability" class="tab-content">
                <div class="section-header">
                    <div class="section-icon">⚖️</div>
                    <div class="section-title">Análisis de Estabilidad y Momento</div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Base de Apoyo Grúa (m):</label>
                        <input type="number" id="craneBase" placeholder="ej: 6.5">
                    </div>
                    <div class="form-group">
                        <label>Peso de Grúa (kg):</label>
                        <input type="number" id="craneWeight" placeholder="ej: 45000">
                    </div>
                    <div class="form-group">
                        <label>Altura Centro Gravedad Grúa (m):</label>
                        <input type="number" id="craneCGHeight" placeholder="ej: 3.2">
                    </div>
                    <div class="form-group">
                        <label>Velocidad de Viento (km/h):</label>
                        <input type="number" id="windSpeed" placeholder="ej: 25">
                    </div>
                    <div class="form-group">
                        <label>Área Expuesta al Viento (m²):</label>
                        <input type="number" id="windArea" placeholder="ej: 15">
                    </div>
                    <div class="form-group">
                        <label>Coeficiente de Forma:</label>
                        <select id="shapeCoeff">
                            <option value="1.2">1.2 (Estructuras regulares)</option>
                            <option value="1.5" selected>1.5 (Estructuras complejas)</option>
                            <option value="2.0">2.0 (Formas irregulares)</option>
                        </select>
                    </div>
                </div>

                <button class="btn" onclick="calculateStability()">Calcular Estabilidad</button>

                <div id="stabilityResult"></div>
            </div>

            <!-- Normativas y Estándares -->
            <div id="standards" class="tab-content">
                <div class="section-header">
                    <div class="section-icon">📋</div>
                    <div class="section-title">Normativas y Estándares Aplicables</div>
                </div>

                <div class="standards-grid">
                    <div class="standard-card">
                        <div class="standard-icon">🇨🇱</div>
                        <h3>DS 132 (Chile)</h3>
                        <p>Reglamento de Seguridad Minera - Equipos de Izaje y Transporte</p>
                    </div>
                    <div class="standard-card">
                        <div class="standard-icon">🇺🇸</div>
                        <h3>ANSI/ASME B30</h3>
                        <p>Estándares para Grúas, Polipastos y Equipos de Izaje</p>
                    </div>
                    <div class="standard-card">
                        <div class="standard-icon">🌍</div>
                        <h3>ISO 4301</h3>
                        <p>Clasificación de Grúas - Coeficientes de Seguridad</p>
                    </div>
                    <div class="standard-card">
                        <div class="standard-icon">⚡</div>
                        <h3>EN 13001</h3>
                        <p>Principios Generales de Diseño para Equipos de Izaje</p>
                    </div>
                </div>

                <h3>Factores de Seguridad por Normativa</h3>
                <table class="reference-table">
                    <thead>
                        <tr>
                            <th>Tipo de Operación</th>
                            <th>DS 132</th>
                            <th>ANSI B30</th>
                            <th>ISO 4301</th>
                            <th>Recomendado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Operación Normal</td>
                            <td>1.25</td>
                            <td>1.15</td>
                            <td>1.34</td>
                            <td>1.5</td>
                        </tr>
                        <tr>
                            <td>Operación Crítica</td>
                            <td>2.0</td>
                            <td>1.5</td>
                            <td>2.0</td>
                            <td>2.0</td>
                        </tr>
                        <tr>
                            <td>Izaje de Personal</td>
                            <td>8.0</td>
                            <td>10.0</td>
                            <td>8.0</td>
                            <td>10.0</td>
                        </tr>
                        <tr>
                            <td>Eslingas Textiles</td>
                            <td>6.0</td>
                            <td>5.0</td>
                            <td>6.0</td>
                            <td>6.0</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Capacidades Típicas de Eslingas (Cable de Acero 6x19)</h3>
                <table class="reference-table">
                    <thead>
                        <tr>
                            <th>Diámetro (mm)</th>
                            <th>Carga Trabajo (kg)</th>
                            <th>Resistencia Rotura (kg)</th>
                            <th>Peso por metro (kg/m)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>8</td><td>410</td><td>2460</td><td>0.21</td></tr>
                        <tr><td>10</td><td>640</td><td>3840</td><td>0.33</td></tr>
                        <tr><td>12</td><td>920</td><td>5520</td><td>0.48</td></tr>
                        <tr><td>16</td><td>1640</td><td>9840</td><td>0.85</td></tr>
                        <tr><td>20</td><td>2560</td><td>15360</td><td>1.33</td></tr>
                        <tr><td>24</td><td>3680</td><td>22080</td><td>1.91</td></tr>
                        <tr><td>28</td><td>5010</td><td>30060</td><td>2.60</td></tr>
                        <tr><td>32</td><td>6550</td><td>39300</td><td>3.40</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Reportes Técnicos -->
            <div id="reports" class="tab-content">
                <div class="section-header">
                    <div class="section-icon">📊</div>
                    <div class="section-title">Generación de Reportes Técnicos</div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Proyecto:</label>
                        <input type="text" id="projectName" placeholder="ej: Expansión Mina Los Pelambres">
                    </div>
                    <div class="form-group">
                        <label>Ingeniero Responsable:</label>
                        <input type="text" id="engineerName" placeholder="Nombre del profesional">
                    </div>
                    <div class="form-group">
                        <label>Empresa:</label>
                        <input type="text" id="companyName" placeholder="ej: Minera Los Pelambres">
                    </div>
                    <div class="form-group">
                        <label>Fecha de Operación:</label>
                        <input type="date" id="operationDate">
                    </div>
                </div>

                <button class="btn btn-export" onclick="generateProfessionalPDF('complete')">Generar Reporte PDF Completo</button>
                <button class="btn btn-secondary" onclick="exportToExcel()">Exportar Datos a Excel</button>
                <button class="btn" onclick="generateFullReport()">Vista Previa del Reporte</button>

                <div id="reportPreview"></div>
            </div>
        </div>
    </div>

    <!-- Footer con crédito del desarrollador -->
    <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: rgba(255,255,255,0.8); text-align: center; padding: 15px; margin-top: 40px;">
        <div style="font-size: 0.9em; margin-bottom: 5px;">
            <strong>Sistema de Cálculos de Izaje - Minería Norte Chile</strong>
        </div>
        <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 8px;">
            Certificado ISO 9001:2015 | Cumple normativas DS 132, ANSI/ASME B30, ISO 4301
        </div>
        <div style="font-size: 0.75em; opacity: 0.7; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 8px;">
            Desarrollado por <strong>RaulPivetA.</strong> | © 2025 | Válido para autoridades mineras
        </div>
    </div>

    <script>
        // Variables globales para almacenar resultados
        let analysisResults = {
            crane: null,
            sling: null,
            structural: null,
            stability: null
        };

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const tabButtons = document.querySelectorAll('.tab');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            tabButtons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function calculateCraneAnalysis() {
            const loadWeight = parseFloat(document.getElementById('craneLoadWeight').value);
            const radius = parseFloat(document.getElementById('craneRadius').value);
            const height = parseFloat(document.getElementById('liftHeight').value);
            const capacity = parseFloat(document.getElementById('craneCapacityNominal').value);
            const safetyFactor = parseFloat(document.getElementById('craneSafetyFactor').value);
            const craneType = document.getElementById('craneType').value;
            const weather = document.getElementById('weatherConditions').value;

            if (!loadWeight || !radius || !capacity) {
                alert('Complete los campos principales para el análisis');
                return;
            }

            // Factores de reducción por condiciones
            let weatherFactor = 1.0;
            if (weather === 'moderate') weatherFactor = 0.85;
            if (weather === 'severe') weatherFactor = 0.7;

            let heightFactor = 1.0;
            if (height > 30) heightFactor = 0.95;
            if (height > 50) heightFactor = 0.9;

            // Capacidad efectiva
            const effectiveCapacity = capacity * weatherFactor * heightFactor;
            const requiredCapacity = loadWeight * safetyFactor;
            const utilizationPercentage = (requiredCapacity / effectiveCapacity) * 100;

            // Cálculo de momento
            const loadMoment = loadWeight * radius;
            const maxMoment = effectiveCapacity * radius;

            // Análisis de estabilidad básico
            const stabilityRatio = maxMoment / loadMoment;

            let resultHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">Análisis Completo de Grúa</div>' +
                    '<div>' + new Date().toLocaleDateString() + '</div>' +
                '</div>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">Carga a Izar</div>' +
                        '<div class="result-value">' + loadWeight.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Capacidad Efectiva</div>' +
                        '<div class="result-value">' + effectiveCapacity.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Capacidad Requerida</div>' +
                        '<div class="result-value">' + requiredCapacity.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Utilización</div>' +
                        '<div class="result-value">' + utilizationPercentage.toFixed(1) + '<span class="result-unit">%</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Momento de Carga</div>' +
                        '<div class="result-value">' + loadMoment.toLocaleString() + '<span class="result-unit">kg⋅m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Radio de Operación</div>' +
                        '<div class="result-value">' + radius + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Factor de Seguridad</div>' +
                        '<div class="result-value">' + safetyFactor + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Ratio de Estabilidad</div>' +
                        '<div class="result-value">' + stabilityRatio.toFixed(2) + '</div>' +
                    '</div>' +
                '</div>' +
                '<div class="calculation-steps">' +
                    '<h4>Pasos de Cálculo</h4>' +
                    '<div class="step">' +
                        '<span class="step-number">1.</span>' +
                        'Capacidad Efectiva = Capacidad Nominal × Factor Climático × Factor Altura' +
                    '</div>' +
                    '<div class="formula">' +
                        effectiveCapacity.toLocaleString() + ' kg = ' + capacity.toLocaleString() + ' × ' + weatherFactor + ' × ' + heightFactor +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">2.</span>' +
                        'Capacidad Requerida = Peso Carga × Factor Seguridad' +
                    '</div>' +
                    '<div class="formula">' +
                        requiredCapacity.toLocaleString() + ' kg = ' + loadWeight.toLocaleString() + ' × ' + safetyFactor +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">3.</span>' +
                        'Utilización = (Cap. Requerida / Cap. Efectiva) × 100' +
                    '</div>' +
                    '<div class="formula">' +
                        utilizationPercentage.toFixed(1) + '% = (' + requiredCapacity.toLocaleString() + ' / ' + effectiveCapacity.toLocaleString() + ') × 100' +
                    '</div>' +
                '</div>';

            // Evaluación de seguridad
            if (utilizationPercentage <= 75) {
                resultHtml += '<div class="alert alert-success">' +
                    '<span class="alert-icon">✅</span>' +
                    '<div>' +
                        '<strong>OPERACIÓN SEGURA - AUTORIZADA</strong><br>' +
                        'Utilización óptima. La grúa tiene amplia capacidad para esta operación. ' +
                        'Cumple con todos los estándares de seguridad minera.' +
                    '</div>' +
                '</div>';
            } else if (utilizationPercentage <= 85) {
                resultHtml += '<div class="alert alert-warning">' +
                    '<span class="alert-icon">⚠️</span>' +
                    '<div>' +
                        '<strong>PRECAUCIÓN - REQUIERE SUPERVISIÓN</strong><br>' +
                        'Utilización moderadamente alta. Verificar condiciones específicas del terreno, ' +
                        'clima y operador antes de proceder.' +
                    '</div>' +
                '</div>';
            } else if (utilizationPercentage <= 100) {
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">⚠️</span>' +
                    '<div>' +
                        '<strong>RIESGO ALTO - EVALUACIÓN ESPECIAL REQUERIDA</strong><br>' +
                        'Utilización muy alta. Requiere aprobación de supervisor de operaciones ' +
                        'y verificación exhaustiva de todos los parámetros.' +
                    '</div>' +
                '</div>';
            } else {
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">❌</span>' +
                    '<div>' +
                        '<strong>OPERACIÓN PROHIBIDA - CAPACIDAD INSUFICIENTE</strong><br>' +
                        'La grúa NO tiene capacidad para esta operación. Seleccionar equipo ' +
                        'de mayor capacidad o reducir la carga.' +
                    '</div>' +
                '</div>';
            }

            resultHtml += '</div>';

            // Guardar resultados para reporte
            analysisResults.crane = {
                loadWeight: loadWeight, 
                radius: radius, 
                height: height, 
                capacity: capacity, 
                effectiveCapacity: effectiveCapacity,
                requiredCapacity: requiredCapacity, 
                utilizationPercentage: utilizationPercentage, 
                safetyFactor: safetyFactor,
                craneType: craneType, 
                weather: weather, 
                loadMoment: loadMoment, 
                stabilityRatio: stabilityRatio
            };

            document.getElementById('craneAnalysisResult').innerHTML = resultHtml;
        }

        function calculateSlingEngineering() {
            const weight = parseFloat(document.getElementById('slingLoadWeight').value);
            const legs = parseInt(document.getElementById('slingLegsCount').value);
            const angle = parseFloat(document.getElementById('slingAngleInput').value);
            const diameter = parseFloat(document.getElementById('slingDiameter').value);
            const safetyFactor = parseFloat(document.getElementById('slingSafetyFactor').value);
            const material = document.getElementById('slingMaterial').value;
            const condition = document.getElementById('slingCondition').value;
            const temperature = parseFloat(document.getElementById('workingTemp').value);

            if (!weight || !angle || !diameter) {
                alert('Complete los campos principales para el análisis');
                return;
            }

            // Factores de eficiencia por ángulo
            const angleRad = angle * Math.PI / 180;
            const angleEfficiency = Math.sin(angleRad);

            // Factor de distribución para múltiples ramales
            let distributionFactor = 1.0;
            if (legs === 2) distributionFactor = 1.0;
            if (legs === 3) distributionFactor = 0.9;
            if (legs === 4) distributionFactor = 0.8;
            if (legs >= 6) distributionFactor = 0.75;

            // Carga por ramal
            const loadPerLeg = weight / legs;
            const tensionPerLeg = loadPerLeg / (angleEfficiency * distributionFactor);

            // Capacidades por material y diámetro
            const materialCapacities = {
                steel: { 8: 2460, 10: 3840, 12: 5520, 16: 9840, 20: 15360, 24: 22080, 28: 30060, 32: 39300 },
                synthetic: { 8: 1800, 10: 2800, 12: 4000, 16: 7200, 20: 11200, 24: 16000, 28: 22000, 32: 28800 },
                chain: { 8: 3200, 10: 5000, 12: 7200, 16: 12800, 20: 20000, 24: 28800, 28: 39200, 32: 51200 },
                'wire-rope': { 8: 2200, 10: 3400, 12: 4900, 16: 8700, 20: 13600, 24: 19600, 28: 26600, 32: 34800 }
            };

            // Factor por condición
            const conditionFactors = { new: 1.0, good: 0.85, fair: 0.75, poor: 0.65 };
            const conditionFactor = conditionFactors[condition];

            // Factor por temperatura
            let tempFactor = 1.0;
            if (temperature < -20) tempFactor = 0.9;
            if (temperature > 80) tempFactor = 0.85;
            if (temperature > 150) tempFactor = 0.7;

            const breakingStrength = materialCapacities[material][diameter] || 0;
            const workingLoad = (breakingStrength * conditionFactor * tempFactor) / safetyFactor;

            // Presión específica en contacto
            const contactPressure = tensionPerLeg / (Math.PI * (diameter/1000) * 0.1);

            let resultHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">Ingeniería de Eslingas - Análisis Detallado</div>' +
                    '<div>' + new Date().toLocaleDateString() + '</div>' +
                '</div>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">Carga por Ramal</div>' +
                        '<div class="result-value">' + loadPerLeg.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Tensión por Ramal</div>' +
                        '<div class="result-value">' + tensionPerLeg.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Capacidad de Trabajo</div>' +
                        '<div class="result-value">' + workingLoad.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Resistencia a Rotura</div>' +
                        '<div class="result-value">' + breakingStrength.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Eficiencia Angular</div>' +
                        '<div class="result-value">' + angleEfficiency.toFixed(3) + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Factor Distribución</div>' +
                        '<div class="result-value">' + distributionFactor.toFixed(2) + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Presión de Contacto</div>' +
                        '<div class="result-value">' + contactPressure.toFixed(1) + '<span class="result-unit">MPa</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Utilización de Eslinga</div>' +
                        '<div class="result-value">' + ((tensionPerLeg/workingLoad)*100).toFixed(1) + '<span class="result-unit">%</span></div>' +
                    '</div>' +
                '</div>' +
                '<div class="calculation-steps">' +
                    '<h4>Metodología de Cálculo</h4>' +
                    '<div class="step">' +
                        '<span class="step-number">1.</span>' +
                        'Carga por Ramal = Peso Total / Número de Ramales' +
                    '</div>' +
                    '<div class="formula">' +
                        loadPerLeg.toLocaleString() + ' kg = ' + weight.toLocaleString() + ' / ' + legs +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">2.</span>' +
                        'Tensión = Carga por Ramal / (sen(α) × Factor Distribución)' +
                    '</div>' +
                    '<div class="formula">' +
                        tensionPerLeg.toLocaleString() + ' kg = ' + loadPerLeg.toLocaleString() + ' / (' + angleEfficiency.toFixed(3) + ' × ' + distributionFactor + ')' +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">3.</span>' +
                        'Capacidad Trabajo = (Resistencia × Factor Condición × Factor Temp.) / Factor Seguridad' +
                    '</div>' +
                    '<div class="formula">' +
                        workingLoad.toLocaleString() + ' kg = (' + breakingStrength.toLocaleString() + ' × ' + conditionFactor + ' × ' + tempFactor + ') / ' + safetyFactor +
                    '</div>' +
                '</div>';

            // Evaluación de seguridad
            const utilizationSling = (tensionPerLeg / workingLoad) * 100;

            if (angle < 30) {
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">❌</span>' +
                    '<div>' +
                        '<strong>ÁNGULO CRÍTICO - OPERACIÓN PROHIBIDA</strong><br>' +
                        'Ángulo menor a 30° genera tensiones excesivas. Modificar configuración de izaje.' +
                    '</div>' +
                '</div>';
            } else if (utilizationSling <= 80) {
                resultHtml += '<div class="alert alert-success">' +
                    '<span class="alert-icon">✅</span>' +
                    '<div>' +
                        '<strong>CONFIGURACIÓN ÓPTIMA - OPERACIÓN AUTORIZADA</strong><br>' +
                        'Las eslingas seleccionadas son adecuadas para esta operación. ' +
                        'Factor de seguridad cumple normativas mineras.' +
                    '</div>' +
                '</div>';
            } else if (utilizationSling <= 95) {
                resultHtml += '<div class="alert alert-warning">' +
                    '<span class="alert-icon">⚠️</span>' +
                    '<div>' +
                        '<strong>UTILIZACIÓN ALTA - VERIFICAR CONDICIONES</strong><br>' +
                        'Eslingas en límite superior de trabajo. Inspeccionar detalladamente ' +
                        'antes del uso y considerar diámetro superior.' +
                    '</div>' +
                '</div>';
            } else {
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">❌</span>' +
                    '<div>' +
                        '<strong>CAPACIDAD INSUFICIENTE - CAMBIAR ESPECIFICACIÓN</strong><br>' +
                        'Las eslingas especificadas no tienen capacidad suficiente. ' +
                        'Usar mayor diámetro o más ramales.' +
                    '</div>' +
                '</div>';
            }

            resultHtml += '</div>';

            // Guardar resultados
            analysisResults.sling = {
                weight: weight, 
                legs: legs, 
                angle: angle, 
                diameter: diameter, 
                material: material, 
                tensionPerLeg: tensionPerLeg,
                workingLoad: workingLoad, 
                breakingStrength: breakingStrength, 
                utilizationSling: utilizationSling, 
                safetyFactor: safetyFactor,
                angleEfficiency: angleEfficiency, 
                distributionFactor: distributionFactor, 
                contactPressure: contactPressure
            };

            document.getElementById('slingEngineeringResult').innerHTML = resultHtml;
        }

        function calculateUniformBeam() {
            const totalLength = parseFloat(document.getElementById('structuralLength').value);
            const totalWeight = parseFloat(document.getElementById('structuralWeight').value);

            if (!totalLength || !totalWeight) {
                alert('Ingrese la longitud y peso total para el cálculo');
                return;
            }

            // Para viga uniforme, CG está en el centro
            const centerOfGravity = totalLength / 2;
            document.getElementById('manualCG').value = centerOfGravity.toFixed(2);

            // Calcular puntos de izaje óptimos para viga uniforme
            const liftSpan = totalLength * 0.293; // Puntos de Airy para mínima deflexión
            const liftPoint1 = centerOfGravity - liftSpan;
            const liftPoint2 = centerOfGravity + liftSpan;

            let resultHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">🎯 Cálculo Rápido - Viga Uniforme</div>' +
                    '<div>' + new Date().toLocaleDateString() + '</div>' +
                '</div>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">Centro de Gravedad</div>' +
                        '<div class="result-value">' + centerOfGravity.toFixed(2) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Punto de Izaje 1 (Óptimo)</div>' +
                        '<div class="result-value">' + liftPoint1.toFixed(2) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Punto de Izaje 2 (Óptimo)</div>' +
                        '<div class="result-value">' + liftPoint2.toFixed(2) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Separación entre Puntos</div>' +
                        '<div class="result-value">' + (liftPoint2 - liftPoint1).toFixed(2) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Carga por Punto</div>' +
                        '<div class="result-value">' + (totalWeight/2).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Peso Lineal</div>' +
                        '<div class="result-value">' + (totalWeight/totalLength).toFixed(0) + '<span class="result-unit">kg/m</span></div>' +
                    '</div>' +
                '</div>' +
                '<div class="alert alert-success">' +
                    '<span class="alert-icon">✅</span>' +
                    '<div>' +
                        '<strong>CONFIGURACIÓN ÓPTIMA CALCULADA</strong><br>' +
                        'Puntos de Airy aplicados para mínima deflexión y máxima estabilidad. ' +
                        'Ideal para vigas uniformes y estructuras simétricas.' +
                    '</div>' +
                '</div>' +
            '</div>';

            document.getElementById('structuralAnalysisResult').innerHTML = resultHtml;
        }

        function addConcentratedLoad() {
            const container = document.getElementById('concentratedLoads');
            const newLoad = document.createElement('div');
            newLoad.className = 'form-grid load-point';
            newLoad.innerHTML = '<div class="form-group">' +
                '<label>Posición desde extremo izquierdo (m):</label>' +
                '<input type="number" class="load-position" placeholder="ej: 8.2">' +
            '</div>' +
            '<div class="form-group">' +
                '<label>Peso concentrado (kg):</label>' +
                '<input type="number" class="load-weight" placeholder="ej: 850">' +
            '</div>' +
            '<div class="form-group">' +
                '<label>Descripción:</label>' +
                '<input type="text" class="load-description" placeholder="ej: Bomba auxiliar">' +
            '</div>' +
            '<div class="form-group">' +
                '<button class="btn btn-secondary" onclick="removeLoad(this)" style="margin-top: 28px;">Eliminar</button>' +
            '</div>';
            container.appendChild(newLoad);
        }

        function removeLoad(button) {
            button.closest('.load-point').remove();
        }

        function calculateStructuralAnalysis() {
            const totalLength = parseFloat(document.getElementById('structuralLength').value);
            const totalWeight = parseFloat(document.getElementById('structuralWeight').value);
            const structureType = document.getElementById('structureType').value;
            const manualCG = parseFloat(document.getElementById('manualCG').value);

            if (!totalLength || !totalWeight) {
                alert('Complete la longitud y peso total de la estructura');
                return;
            }

            const positions = document.querySelectorAll('.load-position');
            const weights = document.querySelectorAll('.load-weight');
            const descriptions = document.querySelectorAll('.load-description');
            
            let totalMoment = 0;
            let concentratedWeight = 0;
            let loadDetails = [];

            // Recopilar cargas concentradas
            for (let i = 0; i < positions.length; i++) {
                const pos = parseFloat(positions[i].value);
                const weight = parseFloat(weights[i].value);
                const desc = descriptions[i].value || 'Carga ' + (i+1);
                
                if (pos && weight) {
                    totalMoment += pos * weight;
                    concentratedWeight += weight;
                    loadDetails.push({ position: pos, weight: weight, description: desc });
                }
            }

            let centerOfGravity;
            let calculationMethod = '';

            // Determinar método de cálculo del CG
            if (manualCG && manualCG > 0) {
                centerOfGravity = manualCG;
                calculationMethod = 'Centro de Gravedad Especificado Manualmente';
            } else if (concentratedWeight > 0) {
                // Peso distribuido restante
                const distributedWeight = totalWeight - concentratedWeight;
                const distributedMoment = (totalLength / 2) * distributedWeight;

                const totalMomentFinal = totalMoment + distributedMoment;
                centerOfGravity = totalMomentFinal / totalWeight;
                calculationMethod = 'Calculado con Cargas Concentradas + Peso Distribuido';
            } else {
                // Viga uniforme por defecto
                centerOfGravity = totalLength / 2;
                calculationMethod = 'Viga Uniforme (Centro Geométrico)';
            }

            // Validación del CG
            if (centerOfGravity <= 0 || centerOfGravity >= totalLength) {
                alert('⚠️ ADVERTENCIA: Centro de gravedad fuera de los límites de la estructura');
            }

            // Puntos de izaje optimizados según el tipo de estructura
            let liftSpan;
            switch(structureType) {
                case 'beam':
                    liftSpan = totalLength * 0.293; // Puntos de Airy
                    break;
                case 'equipment':
                    liftSpan = totalLength * 0.25; // Más conservador para equipos
                    break;
                case 'tank':
                    liftSpan = totalLength * 0.2; // Muy conservador para tanques
                    break;
                default:
                    liftSpan = totalLength * 0.3;
            }

            const liftPoint1 = Math.max(0.05 * totalLength, centerOfGravity - liftSpan/2);
            const liftPoint2 = Math.min(0.95 * totalLength, centerOfGravity + liftSpan/2);

            // Cálculo de reacciones en puntos de izaje
            const d1 = liftPoint2 - liftPoint1;
            const reaction1 = totalWeight * (liftPoint2 - centerOfGravity) / d1;
            const reaction2 = totalWeight * (centerOfGravity - liftPoint1) / d1;

            // Cálculo de momentos flexionantes máximos
            const maxMoment1 = Math.abs(reaction1 * (centerOfGravity - liftPoint1));
            const maxMoment2 = Math.abs(reaction2 * (liftPoint2 - centerOfGravity));

            let resultHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">📐 Análisis Completo de Centro de Gravedad</div>' +
                    '<div>' + new Date().toLocaleDateString() + '</div>' +
                '</div>' +
                '<div class="alert alert-warning">' +
                    '<span class="alert-icon">🔬</span>' +
                    '<div><strong>Método de Cálculo:</strong> ' + calculationMethod + '</div>' +
                '</div>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">🎯 Centro de Gravedad</div>' +
                        '<div class="result-value">' + centerOfGravity.toFixed(3) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Peso Concentrado Total</div>' +
                        '<div class="result-value">' + concentratedWeight.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Peso Distribuido</div>' +
                        '<div class="result-value">' + (totalWeight - concentratedWeight).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">📍 Punto de Izaje 1</div>' +
                        '<div class="result-value">' + liftPoint1.toFixed(3) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">📍 Punto de Izaje 2</div>' +
                        '<div class="result-value">' + liftPoint2.toFixed(3) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">⚖️ Reacción Punto 1</div>' +
                        '<div class="result-value">' + reaction1.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">⚖️ Reacción Punto 2</div>' +
                        '<div class="result-value">' + reaction2.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">📏 Separación de Puntos</div>' +
                        '<div class="result-value">' + (liftPoint2 - liftPoint1).toFixed(2) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">📊 Momento Máximo</div>' +
                        '<div class="result-value">' + Math.max(maxMoment1, maxMoment2).toLocaleString() + '<span class="result-unit">kg⋅m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">% Desbalance</div>' +
                        '<div class="result-value">' + Math.abs(((reaction1-reaction2)/totalWeight)*100).toFixed(1) + '<span class="result-unit">%</span></div>' +
                    '</div>' +
                '</div>' +
                '<div class="calculation-steps">' +
                    '<h4>🧮 Pasos de Cálculo del Centro de Gravedad</h4>' +
                    '<div class="step">' +
                        '<span class="step-number">1.</span>' +
                        'Momento Total = Σ(Peso × Distancia) para todas las cargas' +
                    '</div>' +
                    '<div class="formula">' +
                        'Momento = ' + totalMoment.toLocaleString() + ' kg⋅m (cargas concentradas) + ' + ((totalWeight - concentratedWeight) * totalLength/2).toLocaleString() + ' kg⋅m (distribuido)' +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">2.</span>' +
                        'Centro de Gravedad = Momento Total / Peso Total' +
                    '</div>' +
                    '<div class="formula">' +
                        'CG = ' + centerOfGravity.toFixed(3) + ' m desde extremo izquierdo' +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">3.</span>' +
                        'Reacciones: R₁ = W×(P₂-CG)/(P₂-P₁) | R₂ = W×(CG-P₁)/(P₂-P₁)' +
                    '</div>' +
                    '<div class="formula">' +
                        'R₁ = ' + reaction1.toLocaleString() + ' kg | R₂ = ' + reaction2.toLocaleString() + ' kg' +
                    '</div>' +
                '</div>';

            // Mostrar tabla de cargas concentradas si existen
            if (loadDetails.length > 0) {
                resultHtml += '<h4>📋 Detalle de Cargas Concentradas</h4>' +
                    '<table class="reference-table">' +
                        '<thead>' +
                            '<tr>' +
                                '<th>Descripción</th>' +
                                '<th>Posición (m)</th>' +
                                '<th>Peso (kg)</th>' +
                                '<th>Momento (kg⋅m)</th>' +
                                '<th>% del Total</th>' +
                            '</tr>' +
                        '</thead>' +
                        '<tbody>';

                for (let i = 0; i < loadDetails.length; i++) {
                    const load = loadDetails[i];
                    resultHtml += '<tr>' +
                        '<td>' + load.description + '</td>' +
                        '<td>' + load.position.toFixed(2) + '</td>' +
                        '<td>' + load.weight.toLocaleString() + '</td>' +
                        '<td>' + (load.position * load.weight).toLocaleString() + '</td>' +
                        '<td>' + ((load.weight/totalWeight)*100).toFixed(1) + '%</td>' +
                    '</tr>';
                }

                resultHtml += '</tbody></table>';
            }

            // Evaluación de la configuración
            const balanceQuality = Math.abs(((reaction1-reaction2)/totalWeight)*100);
            
            if (balanceQuality <= 5) {
                resultHtml += '<div class="alert alert-success">' +
                    '<span class="alert-icon">✅</span>' +
                    '<div>' +
                        '<strong>CONFIGURACIÓN ÓPTIMA DE IZAJE</strong><br>' +
                        'Excelente balance de cargas (' + balanceQuality.toFixed(1) + '% desbalance).<br>' +
                        '📍 Puntos recomendados: ' + liftPoint1.toFixed(2) + 'm - ' + liftPoint2.toFixed(2) + 'm<br>' +
                        '⚖️ Distribución: ' + ((reaction1/totalWeight)*100).toFixed(1) + '% - ' + ((reaction2/totalWeight)*100).toFixed(1) + '%' +
                    '</div>' +
                '</div>';
            } else if (balanceQuality <= 10) {
                resultHtml += '<div class="alert alert-warning">' +
                    '<span class="alert-icon">⚠️</span>' +
                    '<div>' +
                        '<strong>CONFIGURACIÓN ACEPTABLE - VERIFICAR</strong><br>' +
                        'Desbalance moderado (' + balanceQuality.toFixed(1) + '%). Verificar capacidad de eslingas.<br>' +
                        'Considerar ajustar puntos de izaje si es posible.' +
                    '</div>' +
                '</div>';
            } else {
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">❌</span>' +
                    '<div>' +
                        '<strong>DESBALANCE CRÍTICO - RECONFIGURAR</strong><br>' +
                        'Alto desbalance (' + balanceQuality.toFixed(1) + '%). Riesgo de inclinación excesiva.<br>' +
                        'Revisar distribución de cargas o usar más puntos de izaje.' +
                    '</div>' +
                '</div>';
            }

            resultHtml += '</div>';

            // Guardar resultados
            analysisResults.structural = {
                totalLength: totalLength,
                totalWeight: totalWeight,
                centerOfGravity: centerOfGravity,
                concentratedWeight: concentratedWeight,
                distributedWeight: totalWeight - concentratedWeight,
                liftPoint1: liftPoint1,
                liftPoint2: liftPoint2,
                reaction1: reaction1,
                reaction2: reaction2,
                loadDetails: loadDetails,
                structureType: structureType,
                calculationMethod: calculationMethod,
                balanceQuality: balanceQuality
            };

            document.getElementById('structuralAnalysisResult').innerHTML = resultHtml;
        }

        function calculateStability() {
            const base = parseFloat(document.getElementById('craneBase').value);
            const craneWeight = parseFloat(document.getElementById('craneWeight').value);
            const cgHeight = parseFloat(document.getElementById('craneCGHeight').value);
            const windSpeed = parseFloat(document.getElementById('windSpeed').value);
            const windArea = parseFloat(document.getElementById('windArea').value);
            const shapeCoeff = parseFloat(document.getElementById('shapeCoeff').value);

            if (!base || !craneWeight) {
                alert('Complete los datos básicos de la grúa');
                return;
            }

            // Cálculo de presión de viento (según normativa)
            const windPressure = 0.613 * Math.pow(windSpeed/3.6, 2); // Pa
            const windForce = windPressure * windArea * shapeCoeff; // N
            const windMoment = (windForce * cgHeight) / 1000; // kN⋅m

            // Momento estabilizador
            const stabilizingMoment = (craneWeight * base * 9.81) / 2000; // kN⋅m

            // Factor de estabilidad
            const stabilityFactor = stabilizingMoment / windMoment;

            let resultHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">Análisis de Estabilidad</div>' +
                    '<div>' + new Date().toLocaleDateString() + '</div>' +
                '</div>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">Presión de Viento</div>' +
                        '<div class="result-value">' + windPressure.toFixed(0) + '<span class="result-unit">Pa</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Fuerza de Viento</div>' +
                        '<div class="result-value">' + (windForce/1000).toFixed(1) + '<span class="result-unit">kN</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Momento Volcante</div>' +
                        '<div class="result-value">' + windMoment.toFixed(1) + '<span class="result-unit">kN⋅m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Momento Estabilizador</div>' +
                        '<div class="result-value">' + stabilizingMoment.toFixed(1) + '<span class="result-unit">kN⋅m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Factor de Estabilidad</div>' +
                        '<div class="result-value">' + stabilityFactor.toFixed(2) + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Base de Apoyo</div>' +
                        '<div class="result-value">' + base + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                '</div>' +
                '<div class="formula">' +
                    'Factor de Estabilidad = Momento Estabilizador / Momento Volcante = ' + stabilityFactor.toFixed(2) +
                '</div>';

            if (stabilityFactor >= 2.0) {
                resultHtml += '<div class="alert alert-success">' +
                    '<span class="alert-icon">✅</span>' +
                    '<div>' +
                        '<strong>ESTABILIDAD EXCELENTE</strong><br>' +
                        'Factor de estabilidad superior a 2.0. Operación segura bajo las condiciones especificadas.' +
                    '</div>' +
                '</div>';
            } else if (stabilityFactor >= 1.5) {
                resultHtml += '<div class="alert alert-warning">' +
                    '<span class="alert-icon">⚠️</span>' +
                    '<div>' +
                        '<strong>ESTABILIDAD ACEPTABLE - MONITOREAR CONDICIONES</strong><br>' +
                        'Verificar continuamente condiciones de viento durante la operación.' +
                    '</div>' +
                '</div>';
            } else {
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">❌</span>' +
                    '<div>' +
                        '<strong>RIESGO DE VOLCAMIENTO - OPERACIÓN PROHIBIDA</strong><br>' +
                        'Factor de estabilidad insuficiente. Mejorar base de apoyo o suspender operación.' +
                    '</div>' +
                '</div>';
            }

            resultHtml += '</div>';

            // Guardar resultados
            analysisResults.stability = {
                base: base, 
                craneWeight: craneWeight, 
                cgHeight: cgHeight, 
                windSpeed: windSpeed, 
                windArea: windArea,
                windPressure: windPressure, 
                windForce: windForce, 
                windMoment: windMoment, 
                stabilizingMoment: stabilizingMoment, 
                stabilityFactor: stabilityFactor
            };

            document.getElementById('stabilityResult').innerHTML = resultHtml;
        }

        function generateFullReport() {
            const projectName = document.getElementById('projectName').value || 'Proyecto de Izaje';
            const engineerName = document.getElementById('engineerName').value || 'Ingeniero Responsable';
            const companyName = document.getElementById('companyName').value || 'Empresa Minera';
            const operationDate = document.getElementById('operationDate').value || new Date().toISOString().split('T')[0];

            let reportHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">REPORTE TÉCNICO DE OPERACIÓN DE IZAJE</div>' +
                    '<div>Documento Oficial</div>' +
                '</div>' +
                '<h3>Información del Proyecto</h3>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">Proyecto</div>' +
                        '<div class="result-value">' + projectName + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Empresa</div>' +
                        '<div class="result-value">' + companyName + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Ingeniero Responsable</div>' +
                        '<div class="result-value">' + engineerName + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Fecha de Operación</div>' +
                        '<div class="result-value">' + new Date(operationDate).toLocaleDateString() + '</div>' +
                    '</div>' +
                '</div>';

            // Incluir resumen de todos los análisis realizados
            if (analysisResults.crane) {
                reportHtml += '<h3>Resumen de Análisis de Grúa</h3>' +
                    '<p><strong>Utilización:</strong> ' + analysisResults.crane.utilizationPercentage.toFixed(1) + '% | ' +
                    '<strong>Factor de Seguridad:</strong> ' + analysisResults.crane.safetyFactor + ' | ' +
                    '<strong>Capacidad Efectiva:</strong> ' + analysisResults.crane.effectiveCapacity.toLocaleString() + ' kg</p>';
            }

            if (analysisResults.sling) {
                reportHtml += '<h3>Resumen de Análisis de Eslingas</h3>' +
                    '<p><strong>Tensión por Ramal:</strong> ' + analysisResults.sling.tensionPerLeg.toLocaleString() + ' kg | ' +
                    '<strong>Utilización:</strong> ' + analysisResults.sling.utilizationSling.toFixed(1) + '% | ' +
                    '<strong>Material:</strong> ' + analysisResults.sling.material + '</p>';
            }

            if (analysisResults.structural) {
                reportHtml += '<h3>Resumen de Análisis Estructural</h3>' +
                    '<p><strong>Centro de Gravedad:</strong> ' + analysisResults.structural.centerOfGravity.toFixed(2) + ' m | ' +
                    '<strong>Puntos de Izaje:</strong> ' + analysisResults.structural.liftPoint1.toFixed(2) + ' m - ' + analysisResults.structural.liftPoint2.toFixed(2) + ' m</p>';
            }

            reportHtml += '<div class="alert alert-success">' +
                '<span class="alert-icon">📋</span>' +
                '<div>' +
                    '<strong>REPORTE GENERADO EXITOSAMENTE</strong><br>' +
                    'Este reporte cumple con las normativas DS 132, ANSI B30 e ISO 4301. ' +
                    'Válido para presentación a autoridades mineras.' +
                '</div>' +
            '</div>' +
        '</div>';

            document.getElementById('reportPreview').innerHTML = reportHtml;
        }

        function clearCraneInputs() {
            document.getElementById('craneLoadWeight').value = '';
            document.getElementById('craneRadius').value = '';
            document.getElementById('liftHeight').value = '';
            document.getElementById('craneCapacityNominal').value = '';
            document.getElementById('craneAnalysisResult').innerHTML = '';
        }

        function generateSlingReport() {
            if (!analysisResults.sling) {
                alert('Primero debe realizar el cálculo de eslingas');
                return;
            }
            
            generateProfessionalPDF('sling');
        }

        function exportToExcel() {
            generateProfessionalExcel();
        }

        function generateProfessionalPDF(reportType = 'complete') {
            // Verificar que hay datos para generar reporte
            if (!analysisResults.crane && !analysisResults.sling && !analysisResults.structural && !analysisResults.stability) {
                alert('⚠️ Debe realizar al menos un análisis antes de generar el reporte.');
                return;
            }

            // Cargar jsPDF dinámicamente
            if (typeof window.jsPDF === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                script.onload = function() {
                    setTimeout(() => generatePDFContent(reportType), 100);
                };
                document.head.appendChild(script);
            } else {
                generatePDFContent(reportType);
            }
        }

        function generatePDFContent(reportType) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            // Configuración del documento
            const pageWidth = 210;
            const pageHeight = 297;
            const margin = 15;
            const contentWidth = pageWidth - (margin * 2);
            const footerHeight = 25; // Espacio reservado para footer
            const usableHeight = pageHeight - footerHeight; // Altura útil de la página
            let yPosition = margin;

            // Colores corporativos
            const primaryColor = [231, 76, 60];  // Rojo minero
            const secondaryColor = [44, 62, 80]; // Azul oscuro
            const accentColor = [149, 165, 166]; // Gris

            // HEADER CORPORATIVO - Más compacto
            doc.setFillColor(...primaryColor);
            doc.rect(0, 0, pageWidth, 32, 'F');
            
            // Logo y título principal
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.text('⛏️ SISTEMA DE CÁLCULOS DE IZAJE', margin, 11);
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text('Minería Norte de Chile - Análisis Profesional de Operaciones de Carga', margin, 20);
            doc.text('Certificado ISO 9001:2015 | Cumple DS 132, ANSI B30, ISO 4301', margin, 27);

            // Línea decorativa
            doc.setDrawColor(...secondaryColor);
            doc.setLineWidth(1);
            doc.line(0, 32, pageWidth, 32);
            
            yPosition = 38;

            // INFORMACIÓN DEL PROYECTO - Más compacta y sin desbordamiento
            doc.setTextColor(...secondaryColor);
            doc.setFontSize(13);
            doc.setFont('helvetica', 'bold');
            doc.text('REPORTE TÉCNICO DE OPERACIÓN DE IZAJE', margin, yPosition);
            yPosition += 5;

            // Cuadro de información del proyecto - PERFECTAMENTE AJUSTADO
            const projectBoxHeight = 18; // Más pequeño aún
            doc.setDrawColor(...accentColor);
            doc.setLineWidth(0.5);
            doc.rect(margin, yPosition, contentWidth, projectBoxHeight);
            
            doc.setFillColor(248, 249, 250);
            doc.rect(margin, yPosition, contentWidth, 3.5, 'F'); // Header muy pequeño
            
            doc.setTextColor(...primaryColor);
            doc.setFontSize(7);
            doc.setFont('helvetica', 'bold');
            doc.text('INFORMACIÓN DEL PROYECTO', margin + 2, yPosition + 2.5);
            
            yPosition += 5; // Espacio mínimo
            doc.setTextColor(0, 0, 0);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(7);
            
            const projectName = document.getElementById('projectName').value || 'Proyecto de Izaje Minero';
            const engineerName = document.getElementById('engineerName').value || 'Ingeniero Responsable';
            const companyName = document.getElementById('companyName').value || 'Empresa Minera Norte';
            const operationDate = document.getElementById('operationDate').value || new Date().toISOString().split('T')[0];
            
            // Primera fila
            doc.text('Proyecto:', margin + 2, yPosition);
            doc.setFont('helvetica', 'bold');
            const shortProjectName = projectName.length > 30 ? projectName.substring(0, 27) + '...' : projectName;
            doc.text(shortProjectName, margin + 17, yPosition);
            
            doc.setFont('helvetica', 'normal');
            doc.text('Empresa:', margin + 95, yPosition);
            doc.setFont('helvetica', 'bold');
            const shortCompanyName = companyName.length > 24 ? companyName.substring(0, 21) + '...' : companyName;
            doc.text(shortCompanyName, margin + 108, yPosition);
            yPosition += 3;
            
            // Segunda fila
            doc.setFont('helvetica', 'normal');
            doc.text('Ingeniero:', margin + 2, yPosition);
            doc.setFont('helvetica', 'bold');
            const shortEngineerName = engineerName.length > 28 ? engineerName.substring(0, 25) + '...' : engineerName;
            doc.text(shortEngineerName, margin + 17, yPosition);
            
            doc.setFont('helvetica', 'normal');
            doc.text('Fecha:', margin + 95, yPosition);
            doc.setFont('helvetica', 'bold');
            doc.text(new Date(operationDate).toLocaleDateString('es-ES'), margin + 105, yPosition);
            yPosition += 3;
            
            // Tercera fila
            doc.setFont('helvetica', 'normal');
            doc.text('Generado:', margin + 2, yPosition);
            doc.setFont('helvetica', 'bold');
            doc.text(new Date().toLocaleDateString('es-ES') + ' ' + new Date().toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'}), margin + 17, yPosition);
            
            // Crédito del desarrollador - PERFECTAMENTE POSICIONADO
            doc.setFont('helvetica', 'italic');
            doc.setFontSize(6);
            doc.setTextColor(100, 100, 100);
            doc.text('Desarrollado por: RaulPivetA.', margin + 95, yPosition);
            
            yPosition += 10;

            // RESUMEN EJECUTIVO - Control estricto de altura
            if (yPosition > usableHeight - 50) {
                doc.addPage();
                yPosition = margin + 10;
            }

            doc.setTextColor(...primaryColor);
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('RESUMEN EJECUTIVO', margin, yPosition);
            yPosition += 5;

            let analysisCount = 0;
            let safetySummary = [];

            // Análisis de Grúa - Formato ultra compacto
            if (analysisResults.crane) {
                analysisCount++;
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('• Análisis de Capacidad de Grúa:', margin + 2, yPosition);
                yPosition += 3.5;
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                const craneText = '  Utilización: ' + analysisResults.crane.utilizationPercentage.toFixed(1) + '% | ' +
                    'Factor Seguridad: ' + analysisResults.crane.safetyFactor + ' | ' +
                    'Capacidad Efectiva: ' + analysisResults.crane.effectiveCapacity.toLocaleString() + ' kg';
                doc.text(craneText, margin + 2, yPosition);
                yPosition += 3.5;
                
                // Estado de seguridad
                if (analysisResults.crane.utilizationPercentage <= 75) {
                    safetySummary.push('Grúa: OPERACIÓN SEGURA');
                    doc.setTextColor(21, 87, 36);
                } else if (analysisResults.crane.utilizationPercentage <= 85) {
                    safetySummary.push('Grúa: PRECAUCIÓN');
                    doc.setTextColor(133, 100, 4);
                } else {
                    safetySummary.push('Grúa: RIESGO ALTO');
                    doc.setTextColor(114, 28, 36);
                }
                doc.text('  Estado: ' + safetySummary[safetySummary.length - 1], margin + 2, yPosition);
                yPosition += 5;
            }

            // Análisis de Eslingas - Formato ultra compacto
            if (analysisResults.sling) {
                if (yPosition > usableHeight - 30) {
                    doc.addPage();
                    yPosition = margin + 10;
                }
                
                analysisCount++;
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('• Ingeniería de Eslingas:', margin + 2, yPosition);
                yPosition += 3.5;
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                const slingText = '  Tensión por Ramal: ' + analysisResults.sling.tensionPerLeg.toLocaleString() + ' kg | ' +
                    'Utilización: ' + analysisResults.sling.utilizationSling.toFixed(1) + '% | ' +
                    'Material: ' + analysisResults.sling.material;
                doc.text(slingText, margin + 2, yPosition);
                yPosition += 3.5;
                
                // Estado de seguridad eslingas
                if (analysisResults.sling.angle < 30) {
                    safetySummary.push('Eslingas: ÁNGULO CRÍTICO');
                    doc.setTextColor(114, 28, 36);
                } else if (analysisResults.sling.utilizationSling <= 80) {
                    safetySummary.push('Eslingas: CONFIGURACIÓN ÓPTIMA');
                    doc.setTextColor(21, 87, 36);
                } else if (analysisResults.sling.utilizationSling <= 95) {
                    safetySummary.push('Eslingas: UTILIZACIÓN ALTA');
                    doc.setTextColor(133, 100, 4);
                } else {
                    safetySummary.push('Eslingas: CAPACIDAD INSUFICIENTE');
                    doc.setTextColor(114, 28, 36);
                }
                doc.text('  Estado: ' + safetySummary[safetySummary.length - 1], margin + 2, yPosition);
                yPosition += 5;
            }

            // Análisis Estructural - Formato ultra compacto
            if (analysisResults.structural) {
                if (yPosition > usableHeight - 30) {
                    doc.addPage();
                    yPosition = margin + 10;
                }
                
                analysisCount++;
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('• Centro de Gravedad y Estructura:', margin + 2, yPosition);
                yPosition += 3.5;
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                const structText = '  Centro de Gravedad: ' + analysisResults.structural.centerOfGravity.toFixed(2) + ' m | ' +
                    'Puntos de Izaje: ' + analysisResults.structural.liftPoint1.toFixed(2) + 'm - ' + analysisResults.structural.liftPoint2.toFixed(2) + 'm';
                doc.text(structText, margin + 2, yPosition);
                yPosition += 3.5;
                
                // Balance de cargas
                if (analysisResults.structural.balanceQuality <= 5) {
                    safetySummary.push('Estructura: BALANCE ÓPTIMO');
                    doc.setTextColor(21, 87, 36);
                } else if (analysisResults.structural.balanceQuality <= 10) {
                    safetySummary.push('Estructura: BALANCE ACEPTABLE');
                    doc.setTextColor(133, 100, 4);
                } else {
                    safetySummary.push('Estructura: DESBALANCE CRÍTICO');
                    doc.setTextColor(114, 28, 36);
                }
                doc.text('  Estado: ' + safetySummary[safetySummary.length - 1], margin + 2, yPosition);
                yPosition += 5;
            }

            // CONCLUSIÓN GENERAL - Más destacada y controlada
            if (yPosition > usableHeight - 25) {
                doc.addPage();
                yPosition = margin + 10;
            }
            
            yPosition += 2;
            doc.setTextColor(...primaryColor);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('CONCLUSIÓN GENERAL:', margin, yPosition);
            yPosition += 5;

            // Determinar estado general
            let generalStatus = 'OPERACIÓN AUTORIZADA';
            let statusColor = [21, 87, 36];
            
            if (safetySummary.some(s => s.includes('CRÍTICO') || s.includes('INSUFICIENTE') || s.includes('RIESGO ALTO'))) {
                generalStatus = 'OPERACIÓN PROHIBIDA - REVISAR PARÁMETROS';
                statusColor = [114, 28, 36];
            } else if (safetySummary.some(s => s.includes('PRECAUCIÓN') || s.includes('ALTA'))) {
                generalStatus = 'OPERACIÓN CONDICIONAL - SUPERVISIÓN REQUERIDA';
                statusColor = [133, 100, 4];
            }

            // Cuadro de conclusión compacto
            doc.setFillColor(...statusColor);
            doc.rect(margin, yPosition - 1, contentWidth, 6, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('✓ ' + generalStatus, margin + 2, yPosition + 2.5);
            yPosition += 10;

            // Nueva página para detalles técnicos
            if (yPosition > usableHeight - 40) {
                doc.addPage();
                yPosition = margin + 10;
            }

            // DETALLES TÉCNICOS COMPLETOS
            doc.setTextColor(...secondaryColor);
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('DETALLES TÉCNICOS COMPLETOS', margin, yPosition);
            yPosition += 6;

            // Agregar cada análisis detallado con control estricto de espacio
            if (analysisResults.crane) {
                yPosition = addCraneDetailsToPage(doc, yPosition, margin, contentWidth, primaryColor, secondaryColor, usableHeight);
            }

            if (analysisResults.sling) {
                if (yPosition > usableHeight - 50) {
                    doc.addPage();
                    yPosition = margin + 10;
                }
                yPosition = addSlingDetailsToPage(doc, yPosition, margin, contentWidth, primaryColor, secondaryColor, usableHeight);
            }

            if (analysisResults.structural) {
                if (yPosition > usableHeight - 50) {
                    doc.addPage();
                    yPosition = margin + 10;
                }
                yPosition = addStructuralDetailsToPage(doc, yPosition, margin, contentWidth, primaryColor, secondaryColor, usableHeight);
            }

            // FOOTER EN TODAS LAS PÁGINAS - MEJORADO
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                
                // Línea footer - posición fija desde el final
                const footerY = pageHeight - 18;
                doc.setDrawColor(...accentColor);
                doc.setLineWidth(0.3);
                doc.line(margin, footerY, pageWidth - margin, footerY);
                
                // Texto footer principal
                doc.setTextColor(...accentColor);
                doc.setFontSize(6);
                doc.setFont('helvetica', 'normal');
                doc.text('Sistema de Cálculos de Izaje - Minería Norte Chile | Certificado ISO 9001:2015', margin, footerY + 3);
                
                // Segunda línea con normativas y página
                doc.text('Cumple normativas DS 132, ANSI/ASME B30, ISO 4301 | Página ' + i + ' de ' + totalPages, margin, footerY + 6);
                
                // Tercera línea con fecha y validez
                doc.text('Generado: ' + new Date().toLocaleString('es-ES') + ' | Válido para autoridades mineras', margin, footerY + 9);
                
                // Crédito del desarrollador - MÁS VISIBLE y mejor posicionado
                doc.setFontSize(6);
                doc.setTextColor(80, 80, 80); // Más oscuro para mejor visibilidad
                doc.setFont('helvetica', 'bold');
                doc.text('Desarrollado por: RaulPivetA.', margin, footerY + 12);
                
                // Copyright
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(5);
                doc.setTextColor(120, 120, 120);
                doc.text('© 2025', margin + 55, footerY + 12);
            }

            // Generar nombre del archivo
            const fileName = 'Reporte_Izaje_' + (projectName.replace(/\s+/g, '_')) + '_' + 
                new Date().toISOString().split('T')[0] + '.pdf';

            // Guardar PDF
            doc.save(fileName);
            
            // Mostrar mensaje de éxito
            alert('✅ Reporte PDF generado exitosamente!\n\n' +
                '📄 Archivo: ' + fileName + '\n' +
                '📊 Análisis incluidos: ' + analysisCount + '\n' +
                '🎯 Estado general: ' + generalStatus + '\n\n' +
                '👨‍💻 Desarrollado por: RaulPivetA.\n' +
                '🏆 Cumple estándares profesionales para autoridades mineras.\n' +
                '📋 Válido según normativas DS 132, ANSI B30, ISO 4301');
        }

        function addCraneDetailsToPage(doc, yPos, margin, contentWidth, primaryColor, secondaryColor, usableHeight) {
            if (yPos > usableHeight - 60) {
                doc.addPage();
                yPos = margin + 10;
            }

            doc.setTextColor(...primaryColor);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('ANÁLISIS DETALLADO DE GRÚA', margin, yPos);
            yPos += 6;

            // Crear tabla de resultados más compacta
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');

            const craneData = [
                ['Parámetro', 'Valor', 'Unidad'],
                ['Peso de Carga', analysisResults.crane.loadWeight.toLocaleString(), 'kg'],
                ['Radio de Operación', analysisResults.crane.radius.toString(), 'm'],
                ['Capacidad Nominal', analysisResults.crane.capacity.toLocaleString(), 'kg'],
                ['Capacidad Efectiva', analysisResults.crane.effectiveCapacity.toLocaleString(), 'kg'],
                ['Capacidad Requerida', analysisResults.crane.requiredCapacity.toLocaleString(), 'kg'],
                ['Utilización', analysisResults.crane.utilizationPercentage.toFixed(1), '%'],
                ['Factor de Seguridad', analysisResults.crane.safetyFactor.toString(), '-'],
                ['Momento de Carga', analysisResults.crane.loadMoment.toLocaleString(), 'kg⋅m'],
                ['Ratio de Estabilidad', analysisResults.crane.stabilityRatio.toFixed(2), '-']
            ];

            yPos = drawTable(doc, craneData, margin, yPos, contentWidth, primaryColor, 4.5); // Filas más pequeñas
            return yPos + 6;
        }

        function addSlingDetailsToPage(doc, yPos, margin, contentWidth, primaryColor, secondaryColor, usableHeight) {
            if (yPos > usableHeight - 70) {
                doc.addPage();
                yPos = margin + 10;
            }

            doc.setTextColor(...primaryColor);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('ANÁLISIS DETALLADO DE ESLINGAS', margin, yPos);
            yPos += 6;

            doc.setTextColor(0, 0, 0);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');

            const slingData = [
                ['Parámetro', 'Valor', 'Unidad'],
                ['Peso Total', analysisResults.sling.weight.toLocaleString(), 'kg'],
                ['Número de Ramales', analysisResults.sling.legs.toString(), '-'],
                ['Ángulo de Eslinga', analysisResults.sling.angle.toString(), '°'],
                ['Diámetro', analysisResults.sling.diameter.toString(), 'mm'],
                ['Carga por Ramal', (analysisResults.sling.weight / analysisResults.sling.legs).toLocaleString(), 'kg'],
                ['Tensión por Ramal', analysisResults.sling.tensionPerLeg.toLocaleString(), 'kg'],
                ['Capacidad de Trabajo', analysisResults.sling.workingLoad.toLocaleString(), 'kg'],
                ['Resistencia a Rotura', analysisResults.sling.breakingStrength.toLocaleString(), 'kg'],
                ['Utilización', analysisResults.sling.utilizationSling.toFixed(1), '%'],
                ['Eficiencia Angular', analysisResults.sling.angleEfficiency.toFixed(3), '-'],
                ['Factor de Seguridad', analysisResults.sling.safetyFactor.toString(), '-']
            ];

            yPos = drawTable(doc, slingData, margin, yPos, contentWidth, primaryColor, 4.5);
            return yPos + 6;
        }

        function addStructuralDetailsToPage(doc, yPos, margin, contentWidth, primaryColor, secondaryColor, usableHeight) {
            if (yPos > usableHeight - 70) {
                doc.addPage();
                yPos = margin + 10;
            }

            doc.setTextColor(...primaryColor);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('ANÁLISIS ESTRUCTURAL Y CENTRO DE GRAVEDAD', margin, yPos);
            yPos += 6;

            doc.setTextColor(0, 0, 0);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');

            const structData = [
                ['Parámetro', 'Valor', 'Unidad'],
                ['Longitud Total', analysisResults.structural.totalLength.toString(), 'm'],
                ['Peso Total', analysisResults.structural.totalWeight.toLocaleString(), 'kg'],
                ['Centro de Gravedad', analysisResults.structural.centerOfGravity.toFixed(3), 'm'],
                ['Peso Concentrado', analysisResults.structural.concentratedWeight.toLocaleString(), 'kg'],
                ['Peso Distribuido', analysisResults.structural.distributedWeight.toLocaleString(), 'kg'],
                ['Punto de Izaje 1', analysisResults.structural.liftPoint1.toFixed(3), 'm'],
                ['Punto de Izaje 2', analysisResults.structural.liftPoint2.toFixed(3), 'm'],
                ['Reacción Punto 1', analysisResults.structural.reaction1.toLocaleString(), 'kg'],
                ['Reacción Punto 2', analysisResults.structural.reaction2.toLocaleString(), 'kg'],
                ['Desbalance', analysisResults.structural.balanceQuality.toFixed(1), '%']
            ];

            yPos = drawTable(doc, structData, margin, yPos, contentWidth, primaryColor, 4.5);
            return yPos + 6;
        }

        function drawTable(doc, data, x, y, width, headerColor, rowHeight = 6) {
            const colWidth = width / data[0].length;
            
            // Header
            doc.setFillColor(...headerColor);
            doc.rect(x, y, width, rowHeight, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(8);
            
            for (let j = 0; j < data[0].length; j++) {
                doc.text(data[0][j], x + j * colWidth + 1, y + rowHeight - 1.5);
            }
            
            y += rowHeight;
            
            // Rows
            doc.setTextColor(0, 0, 0);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(7);
            
            for (let i = 1; i < data.length; i++) {
                if (i % 2 === 0) {
                    doc.setFillColor(248, 249, 250);
                    doc.rect(x, y, width, rowHeight, 'F');
                }
                
                for (let j = 0; j < data[i].length; j++) {
                    doc.text(data[i][j].toString(), x + j * colWidth + 1, y + rowHeight - 1.5);
                }
                y += rowHeight;
            }
            
            // Border
            doc.setDrawColor(149, 165, 166);
            doc.setLineWidth(0.3);
            doc.rect(x, y - data.length * rowHeight, width, data.length * rowHeight);
            
            return y;
        }

        function generateProfessionalExcel() {
            // Verificar que hay datos
            if (!analysisResults.crane && !analysisResults.sling && !analysisResults.structural && !analysisResults.stability) {
                alert('⚠️ Debe realizar al menos un análisis antes de exportar a Excel.');
                return;
            }

            // Crear datos para Excel
            let excelData = [];
            let currentRow = 0;

            // Header
            excelData[currentRow++] = ['REPORTE TÉCNICO DE OPERACIÓN DE IZAJE'];
            excelData[currentRow++] = ['Sistema de Cálculos de Izaje - Minería Norte Chile'];
            excelData[currentRow++] = ['Certificado ISO 9001:2015 | Normativas DS 132, ANSI B30, ISO 4301'];
            excelData[currentRow++] = [''];

            // Información del proyecto
            excelData[currentRow++] = ['INFORMACIÓN DEL PROYECTO'];
            excelData[currentRow++] = ['Proyecto:', document.getElementById('projectName').value || 'Proyecto de Izaje'];
            excelData[currentRow++] = ['Empresa:', document.getElementById('companyName').value || 'Empresa Minera'];
            excelData[currentRow++] = ['Ingeniero:', document.getElementById('engineerName').value || 'Ingeniero Responsable'];
            excelData[currentRow++] = ['Fecha Operación:', document.getElementById('operationDate').value || new Date().toISOString().split('T')[0]];
            excelData[currentRow++] = ['Reporte Generado:', new Date().toLocaleString('es-ES')];
            excelData[currentRow++] = [''];

            // Datos de cada análisis
            if (analysisResults.crane) {
                excelData[currentRow++] = ['ANÁLISIS DE GRÚA'];
                excelData[currentRow++] = ['Parámetro', 'Valor', 'Unidad'];
                excelData[currentRow++] = ['Peso de Carga', analysisResults.crane.loadWeight, 'kg'];
                excelData[currentRow++] = ['Radio de Operación', analysisResults.crane.radius, 'm'];
                excelData[currentRow++] = ['Capacidad Nominal', analysisResults.crane.capacity, 'kg'];
                excelData[currentRow++] = ['Capacidad Efectiva', analysisResults.crane.effectiveCapacity, 'kg'];
                excelData[currentRow++] = ['Capacidad Requerida', analysisResults.crane.requiredCapacity, 'kg'];
                excelData[currentRow++] = ['Utilización (%)', analysisResults.crane.utilizationPercentage, '%'];
                excelData[currentRow++] = ['Factor de Seguridad', analysisResults.crane.safetyFactor, '-'];
                excelData[currentRow++] = [''];
            }

            if (analysisResults.sling) {
                excelData[currentRow++] = ['ANÁLISIS DE ESLINGAS'];
                excelData[currentRow++] = ['Parámetro', 'Valor', 'Unidad'];
                excelData[currentRow++] = ['Peso Total', analysisResults.sling.weight, 'kg'];
                excelData[currentRow++] = ['Número de Ramales', analysisResults.sling.legs, '-'];
                excelData[currentRow++] = ['Ángulo', analysisResults.sling.angle, '°'];
                excelData[currentRow++] = ['Diámetro', analysisResults.sling.diameter, 'mm'];
                excelData[currentRow++] = ['Tensión por Ramal', analysisResults.sling.tensionPerLeg, 'kg'];
                excelData[currentRow++] = ['Capacidad de Trabajo', analysisResults.sling.workingLoad, 'kg'];
                excelData[currentRow++] = ['Utilización (%)', analysisResults.sling.utilizationSling, '%'];
                excelData[currentRow++] = [''];
            }

            if (analysisResults.structural) {
                excelData[currentRow++] = ['ANÁLISIS ESTRUCTURAL'];
                excelData[currentRow++] = ['Parámetro', 'Valor', 'Unidad'];
                excelData[currentRow++] = ['Longitud Total', analysisResults.structural.totalLength, 'm'];
                excelData[currentRow++] = ['Peso Total', analysisResults.structural.totalWeight, 'kg'];
                excelData[currentRow++] = ['Centro de Gravedad', analysisResults.structural.centerOfGravity, 'm'];
                excelData[currentRow++] = ['Punto de Izaje 1', analysisResults.structural.liftPoint1, 'm'];
                excelData[currentRow++] = ['Punto de Izaje 2', analysisResults.structural.liftPoint2, 'm'];
                excelData[currentRow++] = ['Reacción 1', analysisResults.structural.reaction1, 'kg'];
                excelData[currentRow++] = ['Reacción 2', analysisResults.structural.reaction2, 'kg'];
                excelData[currentRow++] = [''];
            }

            // Convertir a CSV
            let csvContent = '';
            excelData.forEach(row => {
                csvContent += row.map(cell => {
                    if (typeof cell === 'string' && cell.includes(',')) {
                        return '"' + cell + '"';
                    }
                    return cell || '';
                }).join(',') + '\n';
            });

            // Crear y descargar archivo
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'Reporte_Izaje_' + 
                (document.getElementById('projectName').value || 'Proyecto').replace(/\s+/g, '_') + 
                '_' + new Date().toISOString().split('T')[0] + '.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('✅ Datos exportados a Excel (CSV)!\n\nEl archivo se ha descargado y puede abrirse en Excel, LibreOffice Calc, o Google Sheets.');
        }

        // Configurar fecha actual por defecto
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('operationDate').value = today;
        });
    </script>
</body>
</html>