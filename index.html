<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de C√°lculos de Izaje - Miner√≠a Norte Chile</title>
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
         window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        // Reemplaza 'GA_MEASUREMENT_ID' con tu ID real de Google Analytics
        gtag('config', 'G-Y417FSBFB6', {
            page_title: 'Sistema de C√°lculos de Izaje',
            page_location: window.location.href,
            content_group1: 'Aplicaciones Mineras',
            content_group2: 'C√°lculos de Ingenier√≠a'
        });
        
        // Funci√≥n para trackear eventos personalizados
        function trackEvent(action, category, label, value) {
            gtag('event', action, {
                event_category: category,
                event_label: label,
                value: value
            });
        }
        
        // Funci√≥n para trackear c√°lculos realizados
        function trackCalculation(calculationType, parameters) {
            gtag('event', 'calculation_completed', {
                event_category: 'Engineering_Calculations',
                event_label: calculationType,
                custom_parameters: JSON.stringify(parameters)
            });
        }
        
        // Funci√≥n para trackear exportaciones
        function trackExport(exportType, fileFormat) {
            gtag('event', 'export_completed', {
                event_category: 'File_Exports',
                event_label: exportType + '_' + fileFormat,
                export_method: fileFormat
            });
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .header-bar {
            background: linear-gradient(135deg, #d4351c 0%, #aa2317 100%);
            color: white;
            padding: 8px 0;
            text-align: center;
            font-size: clamp(0.7rem, 2vw, 0.9rem);
            font-weight: 600;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            margin-left: 10px;
            margin-right: 10px;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: clamp(15px, 4vw, 25px) clamp(20px, 5vw, 40px);
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #f39c12, #e74c3c, #9b59b6, #3498db);
        }

        .header-content {
            display: grid;
            grid-template-columns: 1fr;
            align-items: center;
            gap: 20px;
        }

        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2.2rem);
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: clamp(0.8rem, 2vw, 1rem);
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .certification-badge {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
        }

        .certification-badge .cert-title {
            font-size: 0.8em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .certification-badge .cert-main {
            font-size: 1.1em;
            font-weight: 700;
        }

        .tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            padding: clamp(12px, 3vw, 16px) clamp(10px, 2vw, 20px);
            background: none;
            border: none;
            cursor: pointer;
            font-size: clamp(0.8rem, 2vw, 0.95rem);
            font-weight: 600;
            color: #495057;
            transition: all 0.3s ease;
            text-align: center;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            background: white;
            color: #2c3e50;
            border-bottom-color: #e74c3c;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .content {
            padding: clamp(20px, 5vw, 35px) clamp(20px, 5vw, 40px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
            flex-wrap: wrap;
        }

        .section-icon {
            font-size: clamp(2rem, 5vw, 2.5rem);
            margin-right: 15px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-title {
            font-size: clamp(1.3rem, 3vw, 1.8rem);
            font-weight: 700;
            color: #2c3e50;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: clamp(15px, 3vw, 25px);
            margin-bottom: 25px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: clamp(0.85rem, 2vw, 0.95rem);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: clamp(12px, 3vw, 14px) 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: clamp(0.9rem, 2vw, 1rem);
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: clamp(12px, 3vw, 14px) clamp(25px, 5vw, 35px);
            border: none;
            border-radius: 8px;
            font-size: clamp(0.9rem, 2vw, 1rem);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 10px 10px 0;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            width: 100%;
            max-width: 200px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
        }

        .btn-export {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .result-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: clamp(15px, 4vw, 25px);
            margin: 25px 0;
            border-left: 5px solid #e74c3c;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
            flex-wrap: wrap;
            gap: 10px;
        }

        .result-title {
            font-size: clamp(1.1rem, 3vw, 1.3rem);
            font-weight: 700;
            color: #2c3e50;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: clamp(15px, 3vw, 20px);
            margin-bottom: 20px;
        }

        .result-item {
            background: white;
            padding: clamp(12px, 3vw, 15px) clamp(15px, 4vw, 20px);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .result-label {
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            color: #7f8c8d;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: clamp(1.2rem, 3vw, 1.4rem);
            font-weight: 700;
            color: #2c3e50;
            word-break: break-word;
        }

        .result-unit {
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            color: #95a5a6;
            margin-left: 5px;
        }

        .alert {
            padding: clamp(15px, 4vw, 18px) clamp(20px, 5vw, 25px);
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            flex-wrap: wrap;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .alert-icon {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            flex-shrink: 0;
        }

        .reference-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
        }

        .reference-table th {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: clamp(10px, 3vw, 15px);
            text-align: left;
            font-weight: 600;
        }

        .reference-table td {
            padding: clamp(8px, 2vw, 12px) clamp(10px, 3vw, 15px);
            border-bottom: 1px solid #dee2e6;
            background: white;
        }

        .reference-table tr:nth-child(even) td {
            background: #f8f9fa;
        }

        /* Tabla responsiva */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .standards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: clamp(15px, 3vw, 20px);
            margin: 25px 0;
        }

        .standard-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: clamp(15px, 4vw, 20px);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .standard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .standard-icon {
            font-size: clamp(2.5rem, 5vw, 3rem);
            margin-bottom: 15px;
            color: #e74c3c;
        }

        .calculation-steps {
            background: #f8f9fa;
            border-radius: 8px;
            padding: clamp(15px, 4vw, 20px);
            margin: 20px 0;
        }

        .step {
            margin-bottom: 15px;
            padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 15px);
            background: white;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }

        .step-number {
            font-weight: 700;
            color: #e74c3c;
            margin-right: 10px;
        }

        .formula {
            background: #2c3e50;
            color: white;
            padding: clamp(12px, 3vw, 15px);
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            text-align: center;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            word-break: break-word;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .button-group .btn {
            flex: 1;
            min-width: 180px;
        }

        /* Mejoras espec√≠ficas para m√≥viles */
        @media (max-width: 768px) {
            .header-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .content {
                padding: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .tabs {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
            
            .tab {
                font-size: 0.8rem;
                padding: 10px 5px;
            }
            
            .result-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button-group .btn {
                max-width: none;
                width: 100%;
            }
            
            .alert {
                flex-direction: column;
                gap: 10px;
            }
            
            .reference-table {
                font-size: 0.7rem;
            }
            
            .reference-table th,
            .reference-table td {
                padding: 8px 4px;
            }
            
            /* Ocultar columnas menos importantes en m√≥vil */
            .reference-table .mobile-hidden {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .container {
                margin: 10px 5px;
                border-radius: 8px;
            }
            
            .header {
                padding: 15px 20px;
            }
            
            .content {
                padding: 15px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
            }
            
            .section-icon {
                margin-right: 0;
                margin-bottom: 10px;
            }
        }

        /* Mejoras para impresi√≥n */
        @media print {
            body {
                background: white !important;
                color: black !important;
            }
            
            .header-bar,
            .tabs,
            .btn {
                display: none !important;
            }
            
            .container {
                box-shadow: none !important;
                border: 1px solid #ccc;
            }
            
            .result-container {
                break-inside: avoid;
            }
            
            .reference-table {
                break-inside: avoid;
            }
        }

        /* Accesibilidad mejorada */
        .btn:focus,
        .form-group input:focus,
        .form-group select:focus,
        .tab:focus {
            outline: 2px solid #e74c3c;
            outline-offset: 2px;
        }

        /* Indicador de carga */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tooltips para mejor UX */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="header-bar">
        SISTEMA CERTIFICADO PARA OPERACIONES MINERAS - CUMPLE NORMATIVAS DS 132 Y ANSI/ASME B30
    </div>

    <div class="container">
        <div class="header">
            <div class="header-content">
                <div>
                    <h1>‚õèÔ∏è Sistema de C√°lculos de Izaje</h1>
                    <p>Miner√≠a Norte de Chile - An√°lisis Profesional de Operaciones de Carga</p>
                    <p>Versi√≥n 2.1 | Actualizado seg√∫n normativas internacionales</p>
                </div>
                <div class="certification-badge">
                    <div class="cert-title">CERTIFICADO</div>
                    <div class="cert-main">ISO 9001:2015</div>
                    <div class="cert-title">Est√°ndares Mineros</div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('crane-analysis')">An√°lisis de Gr√∫a</button>
            <button class="tab" onclick="showTab('sling-engineering')">Ingenier√≠a de Eslingas</button>
            <button class="tab" onclick="showTab('structural-analysis')">Centro de Gravedad</button>
            <button class="tab" onclick="showTab('stability')">Estabilidad y Momento</button>
            <button class="tab" onclick="showTab('standards')">Normativas y Est√°ndares</button>
            <button class="tab" onclick="showTab('reports')">Reportes T√©cnicos</button>
        </div>

        <div class="content">
            <!-- An√°lisis de Gr√∫a -->
            <div id="crane-analysis" class="tab-content active">
                <div class="section-header">
                    <div class="section-icon">üèóÔ∏è</div>
                    <div class="section-title">An√°lisis Completo de Capacidad de Gr√∫a</div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Tipo de Gr√∫a:</label>
                        <select id="craneType">
                            <option value="mobile">Gr√∫a M√≥vil Telesc√≥pica</option>
                            <option value="tower">Gr√∫a Torre</option>
                            <option value="crawler">Gr√∫a Sobre Orugas</option>
                            <option value="overhead">Puente Gr√∫a</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Peso de Carga (kg):</label>
                        <input type="number" id="craneLoadWeight" placeholder="ej: 15000">
                    </div>
                    <div class="form-group">
                        <label>Radio de Operaci√≥n (m):</label>
                        <input type="number" id="craneRadius" placeholder="ej: 18.5">
                    </div>
                    <div class="form-group">
                        <label>Altura de Izaje (m):</label>
                        <input type="number" id="liftHeight" placeholder="ej: 25">
                    </div>
                    <div class="form-group">
                        <label>Capacidad Nominal Gr√∫a (kg):</label>
                        <input type="number" id="craneCapacityNominal" placeholder="ej: 80000">
                    </div>
                    <div class="form-group">
                        <label>Condiciones Ambientales:</label>
                        <select id="weatherConditions">
                            <option value="normal">Normales (< 20 km/h viento)</option>
                            <option value="moderate">Moderadas (20-40 km/h viento)</option>
                            <option value="severe">Severas (> 40 km/h viento)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Factor de Seguridad:</label>
                        <select id="craneSafetyFactor">
                            <option value="1.25">1.25 (Operaci√≥n est√°ndar)</option>
                            <option value="1.5" selected>1.5 (Recomendado miner√≠a)</option>
                            <option value="2.0">2.0 (Operaci√≥n cr√≠tica)</option>
                            <option value="2.5">2.5 (M√°xima seguridad)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Operaci√≥n:</label>
                        <select id="operationType">
                            <option value="standard">Est√°ndar</option>
                            <option value="precision">Precisi√≥n</option>
                            <option value="heavy">Carga Pesada</option>
                            <option value="critical">Cr√≠tica</option>
                        </select>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn" onclick="calculateCraneAnalysis()">Realizar An√°lisis Completo</button>
                    <button class="btn btn-secondary" onclick="clearCraneInputs()">Limpiar Datos</button>
                </div>

                <div id="craneAnalysisResult"></div>
            </div>

            <!-- Ingenier√≠a de Eslingas -->
            <div id="sling-engineering" class="tab-content">
                <div class="section-header">
                    <div class="section-icon">üîó</div>
                    <div class="section-title">Ingenier√≠a Avanzada de Eslingas</div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Peso Total de Carga (kg):</label>
                        <input type="number" id="slingLoadWeight" placeholder="ej: 12000">
                    </div>
                    <div class="form-group">
                        <label>N√∫mero de Ramales:</label>
                        <select id="slingLegsCount">
                            <option value="1">1 Ramal (Vertical)</option>
                            <option value="2" selected>2 Ramales</option>
                            <option value="3">3 Ramales</option>
                            <option value="4">4 Ramales</option>
                            <option value="6">6 Ramales</option>
                            <option value="8">8 Ramales</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>√Ångulo de Eslinga (grados):</label>
                        <input type="number" id="slingAngleInput" value="60" min="15" max="90" placeholder="30-90¬∞">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Material de Eslinga:</label>
                        <select id="slingMaterial">
                            <option value="steel">Cable de Acero (6x19)</option>
                            <option value="synthetic">Sint√©tica Poli√©ster</option>
                            <option value="chain">Cadena Grado 8</option>
                            <option value="wire-rope">Cable Galvanizado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Di√°metro de Eslinga (mm):</label>
                        <input type="number" id="slingDiameter" placeholder="ej: 16">
                    </div>
                    <div class="form-group">
                        <label>Factor de Seguridad:</label>
                        <select id="slingSafetyFactor">
                            <option value="5">5:1 (M√≠nimo aceptable)</option>
                            <option value="6" selected>6:1 (Est√°ndar miner√≠a)</option>
                            <option value="8">8:1 (Alta criticidad)</option>
                            <option value="10">10:1 (M√°xima seguridad)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Condici√≥n de Uso:</label>
                        <select id="slingCondition">
                            <option value="new">Nueva (100%)</option>
                            <option value="good" selected>Buena (85%)</option>
                            <option value="fair">Regular (75%)</option>
                            <option value="poor">Desgastada (65%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperatura de Trabajo (¬∞C):</label>
                        <input type="number" id="workingTemp" value="20" placeholder="-40 a 200">
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn" onclick="calculateSlingEngineering()">Calcular Ingenier√≠a de Eslingas</button>
                    <button class="btn btn-secondary" onclick="generateSlingReport()">Generar Reporte</button>
                </div>

                <div id="slingEngineeringResult"></div>
            </div>

            <!-- An√°lisis Estructural -->
            <div id="structural-analysis" class="tab-content">
                <div class="section-header">
                    <div class="section-icon">‚öñÔ∏è</div>
                    <div class="section-title">Centro de Gravedad y An√°lisis Estructural</div>
                </div>

                <div class="alert alert-warning">
                    <span class="alert-icon">üìê</span>
                    <div>
                        <strong>C√ÅLCULO DE CENTRO DE GRAVEDAD PROFESIONAL</strong><br>
                        Determina el punto de equilibrio exacto para operaciones de izaje seguras seg√∫n normativas mineras.
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Longitud Total de Pieza (m):</label>
                        <input type="number" id="structuralLength" placeholder="ej: 15.5">
                    </div>
                    <div class="form-group">
                        <label>Peso Total (kg):</label>
                        <input type="number" id="structuralWeight" placeholder="ej: 8500">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Estructura:</label>
                        <select id="structureType">
                            <option value="beam">Viga Uniforme</option>
                            <option value="truss">Estructura Reticulada</option>
                            <option value="equipment">Equipo Industrial</option>
                            <option value="module">M√≥dulo de Planta</option>
                            <option value="pipe">Tuber√≠a/Ca√±er√≠a</option>
                            <option value="tank">Estanque/Tanque</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Material Principal:</label>
                        <select id="structureMaterial">
                            <option value="steel">Acero Estructural (7850 kg/m¬≥)</option>
                            <option value="concrete">Hormig√≥n Armado (2400 kg/m¬≥)</option>
                            <option value="aluminum">Aluminio (2700 kg/m¬≥)</option>
                            <option value="composite">Material Compuesto</option>
                        </select>
                    </div>
                </div>

                <h3>üéØ C√°lculo R√°pido de Centro de Gravedad</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Para Viga Uniforme - Centro autom√°tico:</label>
                        <button class="btn btn-secondary" onclick="calculateUniformBeam()">Calcular CG Uniforme</button>
                    </div>
                    <div class="form-group">
                        <label>Distancia del CG desde extremo izquierdo (m):</label>
                        <input type="number" id="manualCG" placeholder="Si conoce el CG exacto">
                    </div>
                </div>

                <h3>Cargas Concentradas</h3>
                <div id="concentratedLoads">
                    <div class="form-grid load-point">
                        <div class="form-group">
                            <label>Posici√≥n desde extremo izquierdo (m):</label>
                            <input type="number" class="load-position" placeholder="ej: 3.5">
                        </div>
                        <div class="form-group">
                            <label>Peso concentrado (kg):</label>
                            <input type="number" class="load-weight" placeholder="ej: 1200">
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n:</label>
                            <input type="text" class="load-description" placeholder="ej: Motor principal">
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="addConcentratedLoad()">Agregar Carga Concentrada</button>
                    <button class="btn" onclick="calculateStructuralAnalysis()">Analizar Estructura</button>
                </div>

                <div id="structuralAnalysisResult"></div>
            </div>

            <!-- Estabilidad y Momento -->
            <div id="stability" class="tab-content">
                <div class="section-header">
                    <div class="section-icon">‚öñÔ∏è</div>
                    <div class="section-title">An√°lisis de Estabilidad y Momento</div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Base de Apoyo Gr√∫a (m):</label>
                        <input type="number" id="craneBase" placeholder="ej: 6.5">
                    </div>
                    <div class="form-group">
                        <label>Peso de Gr√∫a (kg):</label>
                        <input type="number" id="craneWeight" placeholder="ej: 45000">
                    </div>
                    <div class="form-group">
                        <label>Altura Centro Gravedad Gr√∫a (m):</label>
                        <input type="number" id="craneCGHeight" placeholder="ej: 3.2">
                    </div>
                    <div class="form-group">
                        <label>Velocidad de Viento (km/h):</label>
                        <input type="number" id="windSpeed" placeholder="ej: 25">
                    </div>
                    <div class="form-group">
                        <label>√Årea Expuesta al Viento (m¬≤):</label>
                        <input type="number" id="windArea" placeholder="ej: 15">
                    </div>
                    <div class="form-group">
                        <label>Coeficiente de Forma:</label>
                        <select id="shapeCoeff">
                            <option value="1.2">1.2 (Estructuras regulares)</option>
                            <option value="1.5" selected>1.5 (Estructuras complejas)</option>
                            <option value="2.0">2.0 (Formas irregulares)</option>
                        </select>
                    </div>
                </div>

                <button class="btn" onclick="calculateStability()">Calcular Estabilidad</button>

                <div id="stabilityResult"></div>
            </div>

            <!-- Normativas y Est√°ndares -->
            <div id="standards" class="tab-content">
                <div class="section-header">
                    <div class="section-icon">üìã</div>
                    <div class="section-title">Normativas y Est√°ndares Aplicables</div>
                </div>

                <div class="standards-grid">
                    <div class="standard-card">
                        <div class="standard-icon">üá®üá±</div>
                        <h3>DS 132 (Chile)</h3>
                        <p>Reglamento de Seguridad Minera - Equipos de Izaje y Transporte</p>
                    </div>
                    <div class="standard-card">
                        <div class="standard-icon">üá∫üá∏</div>
                        <h3>ANSI/ASME B30</h3>
                        <p>Est√°ndares para Gr√∫as, Polipastos y Equipos de Izaje</p>
                    </div>
                    <div class="standard-card">
                        <div class="standard-icon">üåç</div>
                        <h3>ISO 4301</h3>
                        <p>Clasificaci√≥n de Gr√∫as - Coeficientes de Seguridad</p>
                    </div>
                    <div class="standard-card">
                        <div class="standard-icon">‚ö°</div>
                        <h3>EN 13001</h3>
                        <p>Principios Generales de Dise√±o para Equipos de Izaje</p>
                    </div>
                </div>

                <h3>Factores de Seguridad por Normativa</h3>
                <div class="table-responsive">
                    <table class="reference-table">
                        <thead>
                            <tr>
                                <th>Tipo de Operaci√≥n</th>
                                <th>DS 132</th>
                                <th>ANSI B30</th>
                                <th class="mobile-hidden">ISO 4301</th>
                                <th>Recomendado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Operaci√≥n Normal</td>
                                <td>1.25</td>
                                <td>1.15</td>
                                <td class="mobile-hidden">1.34</td>
                                <td>1.5</td>
                            </tr>
                            <tr>
                                <td>Operaci√≥n Cr√≠tica</td>
                                <td>2.0</td>
                                <td>1.5</td>
                                <td class="mobile-hidden">2.0</td>
                                <td>2.0</td>
                            </tr>
                            <tr>
                                <td>Izaje de Personal</td>
                                <td>8.0</td>
                                <td>10.0</td>
                                <td class="mobile-hidden">8.0</td>
                                <td>10.0</td>
                            </tr>
                            <tr>
                                <td>Eslingas Textiles</td>
                                <td>6.0</td>
                                <td>5.0</td>
                                <td class="mobile-hidden">6.0</td>
                                <td>6.0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>Capacidades T√≠picas de Eslingas (Cable de Acero 6x19)</h3>
                <div class="table-responsive">
                    <table class="reference-table">
                        <thead>
                            <tr>
                                <th>Di√°metro (mm)</th>
                                <th>Carga Trabajo (kg)</th>
                                <th>Resistencia Rotura (kg)</th>
                                <th class="mobile-hidden">Peso por metro (kg/m)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>8</td><td>410</td><td>2460</td><td class="mobile-hidden">0.21</td></tr>
                            <tr><td>10</td><td>640</td><td>3840</td><td class="mobile-hidden">0.33</td></tr>
                            <tr><td>12</td><td>920</td><td>5520</td><td class="mobile-hidden">0.48</td></tr>
                            <tr><td>16</td><td>1640</td><td>9840</td><td class="mobile-hidden">0.85</td></tr>
                            <tr><td>20</td><td>2560</td><td>15360</td><td class="mobile-hidden">1.33</td></tr>
                            <tr><td>24</td><td>3680</td><td>22080</td><td class="mobile-hidden">1.91</td></tr>
                            <tr><td>28</td><td>5010</td><td>30060</td><td class="mobile-hidden">2.60</td></tr>
                            <tr><td>32</td><td>6550</td><td>39300</td><td class="mobile-hidden">3.40</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reportes T√©cnicos -->
            <div id="reports" class="tab-content">
                <div class="section-header">
                    <div class="section-icon">üìä</div>
                    <div class="section-title">Generaci√≥n de Reportes T√©cnicos</div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Proyecto:</label>
                        <input type="text" id="projectName" placeholder="ej: Expansi√≥n Mina Los Pelambres">
                    </div>
                    <div class="form-group">
                        <label>Ingeniero Responsable:</label>
                        <input type="text" id="engineerName" placeholder="Nombre del profesional">
                    </div>
                    <div class="form-group">
                        <label>Empresa:</label>
                        <input type="text" id="companyName" placeholder="ej: Minera Los Pelambres">
                    </div>
                    <div class="form-group">
                        <label>Fecha de Operaci√≥n:</label>
                        <input type="date" id="operationDate">
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-export" onclick="generateProfessionalPDF('complete')">Generar Reporte PDF Completo</button>
                    <button class="btn btn-secondary" onclick="exportToExcel()">Exportar Datos a Excel</button>
                    <button class="btn" onclick="generateFullReport()">Vista Previa del Reporte</button>
                </div>

                <div id="reportPreview"></div>
            </div>
        </div>
    </div>

    <!-- Footer con cr√©dito del desarrollador -->
    <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: rgba(255,255,255,0.8); text-align: center; padding: 15px; margin-top: 40px;">
        <div style="font-size: clamp(0.8rem, 2vw, 0.9rem); margin-bottom: 5px;">
            <strong>Sistema de C√°lculos de Izaje - Miner√≠a Norte Chile</strong>
        </div>
        <div style="font-size: clamp(0.7rem, 1.5vw, 0.8rem); opacity: 0.9; margin-bottom: 8px;">
            Certificado ISO 9001:2015 | Cumple normativas DS 132, ANSI/ASME B30, ISO 4301
        </div>
        <div style="font-size: clamp(0.6rem, 1.5vw, 0.75rem); opacity: 0.7; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 8px;">
            Desarrollado por <strong>RaulPivetA.</strong> | ¬© 2025 | V√°lido para autoridades mineras
        </div>
    </div>

    <script>
        // Variables globales para almacenar resultados
        let analysisResults = {
            crane: null,
            sling: null,
            structural: null,
            stability: null
        };

        function showTab(tabName) {
            // Trackear cambio de pesta√±a
            trackEvent('tab_change', 'Navigation', tabName);
            
            const tabs = document.querySelectorAll('.tab-content');
            const tabButtons = document.querySelectorAll('.tab');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            tabButtons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function calculateCraneAnalysis() {
            const loadWeight = parseFloat(document.getElementById('craneLoadWeight').value);
            const radius = parseFloat(document.getElementById('craneRadius').value);
            const height = parseFloat(document.getElementById('liftHeight').value);
            const capacity = parseFloat(document.getElementById('craneCapacityNominal').value);
            const safetyFactor = parseFloat(document.getElementById('craneSafetyFactor').value);
            const craneType = document.getElementById('craneType').value;
            const weather = document.getElementById('weatherConditions').value;

            if (!loadWeight || !radius || !capacity) {
                alert('Complete los campos principales para el an√°lisis');
                return;
            }

            // Trackear el c√°lculo
            trackCalculation('crane_analysis', {
                loadWeight,
                radius,
                height,
                capacity,
                safetyFactor,
                craneType,
                weather
            });

            // Factores de reducci√≥n por condiciones
            let weatherFactor = 1.0;
            if (weather === 'moderate') weatherFactor = 0.85;
            if (weather === 'severe') weatherFactor = 0.7;

            let heightFactor = 1.0;
            if (height > 30) heightFactor = 0.95;
            if (height > 50) heightFactor = 0.9;

            // Capacidad efectiva
            const effectiveCapacity = capacity * weatherFactor * heightFactor;
            const requiredCapacity = loadWeight * safetyFactor;
            const utilizationPercentage = (requiredCapacity / effectiveCapacity) * 100;

            // C√°lculo de momento
            const loadMoment = loadWeight * radius;
            const maxMoment = effectiveCapacity * radius;

            // An√°lisis de estabilidad b√°sico
            const stabilityRatio = maxMoment / loadMoment;

            let resultHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">An√°lisis Completo de Gr√∫a</div>' +
                    '<div>' + new Date().toLocaleDateString() + '</div>' +
                '</div>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">Carga a Izar</div>' +
                        '<div class="result-value">' + loadWeight.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Capacidad Efectiva</div>' +
                        '<div class="result-value">' + Math.round(effectiveCapacity).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Capacidad Requerida</div>' +
                        '<div class="result-value">' + Math.round(requiredCapacity).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Utilizaci√≥n</div>' +
                        '<div class="result-value">' + utilizationPercentage.toFixed(1) + '<span class="result-unit">%</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Momento de Carga</div>' +
                        '<div class="result-value">' + loadMoment.toLocaleString() + '<span class="result-unit">kg‚ãÖm</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Radio de Operaci√≥n</div>' +
                        '<div class="result-value">' + radius + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Factor de Seguridad</div>' +
                        '<div class="result-value">' + safetyFactor + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Ratio de Estabilidad</div>' +
                        '<div class="result-value">' + stabilityRatio.toFixed(2) + '</div>' +
                    '</div>' +
                '</div>' +
                '<div class="calculation-steps">' +
                    '<h4>Pasos de C√°lculo</h4>' +
                    '<div class="step">' +
                        '<span class="step-number">1.</span>' +
                        'Capacidad Efectiva = Capacidad Nominal √ó Factor Clim√°tico √ó Factor Altura' +
                    '</div>' +
                    '<div class="formula">' +
                        Math.round(effectiveCapacity).toLocaleString() + ' kg = ' + capacity.toLocaleString() + ' √ó ' + weatherFactor + ' √ó ' + heightFactor +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">2.</span>' +
                        'Capacidad Requerida = Peso Carga √ó Factor Seguridad' +
                    '</div>' +
                    '<div class="formula">' +
                        Math.round(requiredCapacity).toLocaleString() + ' kg = ' + loadWeight.toLocaleString() + ' √ó ' + safetyFactor +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">3.</span>' +
                        'Utilizaci√≥n = (Cap. Requerida / Cap. Efectiva) √ó 100' +
                    '</div>' +
                    '<div class="formula">' +
                        utilizationPercentage.toFixed(1) + '% = (' + Math.round(requiredCapacity).toLocaleString() + ' / ' + Math.round(effectiveCapacity).toLocaleString() + ') √ó 100' +
                    '</div>' +
                '</div>';

            // Evaluaci√≥n de seguridad
            let safetyStatus = '';
            if (utilizationPercentage <= 75) {
                safetyStatus = 'OPERACI√ìN SEGURA';
                resultHtml += '<div class="alert alert-success">' +
                    '<span class="alert-icon">‚úÖ</span>' +
                    '<div>' +
                        '<strong>OPERACI√ìN SEGURA - AUTORIZADA</strong><br>' +
                        'Utilizaci√≥n √≥ptima. La gr√∫a tiene amplia capacidad para esta operaci√≥n. ' +
                        'Cumple con todos los est√°ndares de seguridad minera.' +
                    '</div>' +
                '</div>';
            } else if (utilizationPercentage <= 85) {
                safetyStatus = 'PRECAUCI√ìN';
                resultHtml += '<div class="alert alert-warning">' +
                    '<span class="alert-icon">‚ö†Ô∏è</span>' +
                    '<div>' +
                        '<strong>PRECAUCI√ìN - REQUIERE SUPERVISI√ìN</strong><br>' +
                        'Utilizaci√≥n moderadamente alta. Verificar condiciones espec√≠ficas del terreno, ' +
                        'clima y operador antes de proceder.' +
                    '</div>' +
                '</div>';
            } else if (utilizationPercentage <= 100) {
                safetyStatus = 'RIESGO ALTO';
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">‚ö†Ô∏è</span>' +
                    '<div>' +
                        '<strong>RIESGO ALTO - EVALUACI√ìN ESPECIAL REQUERIDA</strong><br>' +
                        'Utilizaci√≥n muy alta. Requiere aprobaci√≥n de supervisor de operaciones ' +
                        'y verificaci√≥n exhaustiva de todos los par√°metros.' +
                    '</div>' +
                '</div>';
            } else {
                safetyStatus = 'OPERACI√ìN PROHIBIDA';
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">‚ùå</span>' +
                    '<div>' +
                        '<strong>OPERACI√ìN PROHIBIDA - CAPACIDAD INSUFICIENTE</strong><br>' +
                        'La gr√∫a NO tiene capacidad para esta operaci√≥n. Seleccionar equipo ' +
                        'de mayor capacidad o reducir la carga.' +
                    '</div>' +
                '</div>';
            }

            resultHtml += '</div>';

            // Trackear resultado del an√°lisis
            trackEvent('safety_evaluation', 'Crane_Analysis', safetyStatus, utilizationPercentage);

            // Guardar resultados para reporte
            analysisResults.crane = {
                loadWeight: loadWeight, 
                radius: radius, 
                height: height, 
                capacity: capacity, 
                effectiveCapacity: effectiveCapacity,
                requiredCapacity: requiredCapacity, 
                utilizationPercentage: utilizationPercentage, 
                safetyFactor: safetyFactor,
                craneType: craneType, 
                weather: weather, 
                loadMoment: loadMoment, 
                stabilityRatio: stabilityRatio,
                safetyStatus: safetyStatus
            };

            document.getElementById('craneAnalysisResult').innerHTML = resultHtml;
        }

        function calculateSlingEngineering() {
            const weight = parseFloat(document.getElementById('slingLoadWeight').value);
            const legs = parseInt(document.getElementById('slingLegsCount').value);
            const angle = parseFloat(document.getElementById('slingAngleInput').value);
            const diameter = parseFloat(document.getElementById('slingDiameter').value);
            const safetyFactor = parseFloat(document.getElementById('slingSafetyFactor').value);
            const material = document.getElementById('slingMaterial').value;
            const condition = document.getElementById('slingCondition').value;
            const temperature = parseFloat(document.getElementById('workingTemp').value);

            if (!weight || !angle || !diameter) {
                alert('Complete los campos principales para el an√°lisis');
                return;
            }

            // Trackear el c√°lculo
            trackCalculation('sling_engineering', {
                weight,
                legs,
                angle,
                diameter,
                safetyFactor,
                material,
                condition,
                temperature
            });

            // Factores de eficiencia por √°ngulo
            const angleRad = angle * Math.PI / 180;
            const angleEfficiency = Math.sin(angleRad);

            // Factor de distribuci√≥n para m√∫ltiples ramales
            let distributionFactor = 1.0;
            if (legs === 2) distributionFactor = 1.0;
            if (legs === 3) distributionFactor = 0.9;
            if (legs === 4) distributionFactor = 0.8;
            if (legs >= 6) distributionFactor = 0.75;

            // Carga por ramal
            const loadPerLeg = weight / legs;
            const tensionPerLeg = loadPerLeg / (angleEfficiency * distributionFactor);

            // Capacidades por material y di√°metro
            const materialCapacities = {
                steel: { 8: 2460, 10: 3840, 12: 5520, 16: 9840, 20: 15360, 24: 22080, 28: 30060, 32: 39300 },
                synthetic: { 8: 1800, 10: 2800, 12: 4000, 16: 7200, 20: 11200, 24: 16000, 28: 22000, 32: 28800 },
                chain: { 8: 3200, 10: 5000, 12: 7200, 16: 12800, 20: 20000, 24: 28800, 28: 39200, 32: 51200 },
                'wire-rope': { 8: 2200, 10: 3400, 12: 4900, 16: 8700, 20: 13600, 24: 19600, 28: 26600, 32: 34800 }
            };

            // Factor por condici√≥n
            const conditionFactors = { new: 1.0, good: 0.85, fair: 0.75, poor: 0.65 };
            const conditionFactor = conditionFactors[condition];

            // Factor por temperatura
            let tempFactor = 1.0;
            if (temperature < -20) tempFactor = 0.9;
            if (temperature > 80) tempFactor = 0.85;
            if (temperature > 150) tempFactor = 0.7;

            const breakingStrength = materialCapacities[material][diameter] || 0;
            const workingLoad = (breakingStrength * conditionFactor * tempFactor) / safetyFactor;

            // Presi√≥n espec√≠fica en contacto
            const contactPressure = tensionPerLeg / (Math.PI * (diameter/1000) * 0.1);

            let resultHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">Ingenier√≠a de Eslingas - An√°lisis Detallado</div>' +
                    '<div>' + new Date().toLocaleDateString() + '</div>' +
                '</div>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">Carga por Ramal</div>' +
                        '<div class="result-value">' + Math.round(loadPerLeg).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Tensi√≥n por Ramal</div>' +
                        '<div class="result-value">' + Math.round(tensionPerLeg).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Capacidad de Trabajo</div>' +
                        '<div class="result-value">' + Math.round(workingLoad).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Resistencia a Rotura</div>' +
                        '<div class="result-value">' + breakingStrength.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Eficiencia Angular</div>' +
                        '<div class="result-value">' + angleEfficiency.toFixed(3) + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Factor Distribuci√≥n</div>' +
                        '<div class="result-value">' + distributionFactor.toFixed(2) + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Presi√≥n de Contacto</div>' +
                        '<div class="result-value">' + contactPressure.toFixed(1) + '<span class="result-unit">MPa</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Utilizaci√≥n de Eslinga</div>' +
                        '<div class="result-value">' + ((tensionPerLeg/workingLoad)*100).toFixed(1) + '<span class="result-unit">%</span></div>' +
                    '</div>' +
                '</div>' +
                '<div class="calculation-steps">' +
                    '<h4>Metodolog√≠a de C√°lculo</h4>' +
                    '<div class="step">' +
                        '<span class="step-number">1.</span>' +
                        'Carga por Ramal = Peso Total / N√∫mero de Ramales' +
                    '</div>' +
                    '<div class="formula">' +
                        Math.round(loadPerLeg).toLocaleString() + ' kg = ' + weight.toLocaleString() + ' / ' + legs +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">2.</span>' +
                        'Tensi√≥n = Carga por Ramal / (sen(Œ±) √ó Factor Distribuci√≥n)' +
                    '</div>' +
                    '<div class="formula">' +
                        Math.round(tensionPerLeg).toLocaleString() + ' kg = ' + Math.round(loadPerLeg).toLocaleString() + ' / (' + angleEfficiency.toFixed(3) + ' √ó ' + distributionFactor + ')' +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">3.</span>' +
                        'Capacidad Trabajo = (Resistencia √ó Factor Condici√≥n √ó Factor Temp.) / Factor Seguridad' +
                    '</div>' +
                    '<div class="formula">' +
                        Math.round(workingLoad).toLocaleString() + ' kg = (' + breakingStrength.toLocaleString() + ' √ó ' + conditionFactor + ' √ó ' + tempFactor + ') / ' + safetyFactor +
                    '</div>' +
                '</div>';

            // Evaluaci√≥n de seguridad
            const utilizationSling = (tensionPerLeg / workingLoad) * 100;
            let slingStatus = '';

            if (angle < 30) {
                slingStatus = '√ÅNGULO CR√çTICO';
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">‚ùå</span>' +
                    '<div>' +
                        '<strong>√ÅNGULO CR√çTICO - OPERACI√ìN PROHIBIDA</strong><br>' +
                        '√Ångulo menor a 30¬∞ genera tensiones excesivas. Modificar configuraci√≥n de izaje.' +
                    '</div>' +
                '</div>';
            } else if (utilizationSling <= 80) {
                slingStatus = 'CONFIGURACI√ìN √ìPTIMA';
                resultHtml += '<div class="alert alert-success">' +
                    '<span class="alert-icon">‚úÖ</span>' +
                    '<div>' +
                        '<strong>CONFIGURACI√ìN √ìPTIMA - OPERACI√ìN AUTORIZADA</strong><br>' +
                        'Las eslingas seleccionadas son adecuadas para esta operaci√≥n. ' +
                        'Factor de seguridad cumple normativas mineras.' +
                    '</div>' +
                '</div>';
            } else if (utilizationSling <= 95) {
                slingStatus = 'UTILIZACI√ìN ALTA';
                resultHtml += '<div class="alert alert-warning">' +
                    '<span class="alert-icon">‚ö†Ô∏è</span>' +
                    '<div>' +
                        '<strong>UTILIZACI√ìN ALTA - VERIFICAR CONDICIONES</strong><br>' +
                        'Eslingas en l√≠mite superior de trabajo. Inspeccionar detalladamente ' +
                        'antes del uso y considerar di√°metro superior.' +
                    '</div>' +
                '</div>';
            } else {
                slingStatus = 'CAPACIDAD INSUFICIENTE';
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">‚ùå</span>' +
                    '<div>' +
                        '<strong>CAPACIDAD INSUFICIENTE - CAMBIAR ESPECIFICACI√ìN</strong><br>' +
                        'Las eslingas especificadas no tienen capacidad suficiente. ' +
                        'Usar mayor di√°metro o m√°s ramales.' +
                    '</div>' +
                '</div>';
            }

            resultHtml += '</div>';

            // Trackear resultado del an√°lisis
            trackEvent('safety_evaluation', 'Sling_Analysis', slingStatus, utilizationSling);

            // Guardar resultados
            analysisResults.sling = {
                weight: weight, 
                legs: legs, 
                angle: angle, 
                diameter: diameter, 
                material: material, 
                tensionPerLeg: tensionPerLeg,
                workingLoad: workingLoad, 
                breakingStrength: breakingStrength, 
                utilizationSling: utilizationSling, 
                safetyFactor: safetyFactor,
                angleEfficiency: angleEfficiency, 
                distributionFactor: distributionFactor, 
                contactPressure: contactPressure,
                slingStatus: slingStatus
            };

            document.getElementById('slingEngineeringResult').innerHTML = resultHtml;
        }

        function calculateUniformBeam() {
            const totalLength = parseFloat(document.getElementById('structuralLength').value);
            const totalWeight = parseFloat(document.getElementById('structuralWeight').value);

            if (!totalLength || !totalWeight) {
                alert('Ingrese la longitud y peso total para el c√°lculo');
                return;
            }

            // Trackear uso de la funci√≥n
            trackEvent('quick_calculation', 'Structural_Analysis', 'Uniform_Beam');

            // Para viga uniforme, CG est√° en el centro
            const centerOfGravity = totalLength / 2;
            document.getElementById('manualCG').value = centerOfGravity.toFixed(2);

            // Calcular puntos de izaje √≥ptimos para viga uniforme
            const liftSpan = totalLength * 0.293; // Puntos de Airy para m√≠nima deflexi√≥n
            const liftPoint1 = centerOfGravity - liftSpan;
            const liftPoint2 = centerOfGravity + liftSpan;

            let resultHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">üéØ C√°lculo R√°pido - Viga Uniforme</div>' +
                    '<div>' + new Date().toLocaleDateString() + '</div>' +
                '</div>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">Centro de Gravedad</div>' +
                        '<div class="result-value">' + centerOfGravity.toFixed(2) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Punto de Izaje 1 (√ìptimo)</div>' +
                        '<div class="result-value">' + liftPoint1.toFixed(2) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Punto de Izaje 2 (√ìptimo)</div>' +
                        '<div class="result-value">' + liftPoint2.toFixed(2) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Separaci√≥n entre Puntos</div>' +
                        '<div class="result-value">' + (liftPoint2 - liftPoint1).toFixed(2) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Carga por Punto</div>' +
                        '<div class="result-value">' + (totalWeight/2).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Peso Lineal</div>' +
                        '<div class="result-value">' + (totalWeight/totalLength).toFixed(0) + '<span class="result-unit">kg/m</span></div>' +
                    '</div>' +
                '</div>' +
                '<div class="alert alert-success">' +
                    '<span class="alert-icon">‚úÖ</span>' +
                    '<div>' +
                        '<strong>CONFIGURACI√ìN √ìPTIMA CALCULADA</strong><br>' +
                        'Puntos de Airy aplicados para m√≠nima deflexi√≥n y m√°xima estabilidad. ' +
                        'Ideal para vigas uniformes y estructuras sim√©tricas.' +
                    '</div>' +
                '</div>' +
            '</div>';

            document.getElementById('structuralAnalysisResult').innerHTML = resultHtml;
        }

        function addConcentratedLoad() {
            const container = document.getElementById('concentratedLoads');
            const newLoad = document.createElement('div');
            newLoad.className = 'form-grid load-point';
            newLoad.innerHTML = '<div class="form-group">' +
                '<label>Posici√≥n desde extremo izquierdo (m):</label>' +
                '<input type="number" class="load-position" placeholder="ej: 8.2">' +
            '</div>' +
            '<div class="form-group">' +
                '<label>Peso concentrado (kg):</label>' +
                '<input type="number" class="load-weight" placeholder="ej: 850">' +
            '</div>' +
            '<div class="form-group">' +
                '<label>Descripci√≥n:</label>' +
                '<input type="text" class="load-description" placeholder="ej: Bomba auxiliar">' +
            '</div>' +
            '<div class="form-group">' +
                '<button class="btn btn-secondary" onclick="removeLoad(this)" style="margin-top: 28px;">Eliminar</button>' +
            '</div>';
            container.appendChild(newLoad);
            
            // Trackear agregar carga
            trackEvent('add_concentrated_load', 'Structural_Analysis', 'Load_Added');
        }

        function removeLoad(button) {
            button.closest('.load-point').remove();
            trackEvent('remove_concentrated_load', 'Structural_Analysis', 'Load_Removed');
        }

        function calculateStructuralAnalysis() {
            const totalLength = parseFloat(document.getElementById('structuralLength').value);
            const totalWeight = parseFloat(document.getElementById('structuralWeight').value);
            const structureType = document.getElementById('structureType').value;
            const manualCG = parseFloat(document.getElementById('manualCG').value);

            if (!totalLength || !totalWeight) {
                alert('Complete la longitud y peso total de la estructura');
                return;
            }

            // Trackear el c√°lculo
            trackCalculation('structural_analysis', {
                totalLength,
                totalWeight,
                structureType,
                manualCG: manualCG || 'automatic'
            });

            const positions = document.querySelectorAll('.load-position');
            const weights = document.querySelectorAll('.load-weight');
            const descriptions = document.querySelectorAll('.load-description');
            
            let totalMoment = 0;
            let concentratedWeight = 0;
            let loadDetails = [];

            // Recopilar cargas concentradas
            for (let i = 0; i < positions.length; i++) {
                const pos = parseFloat(positions[i].value);
                const weight = parseFloat(weights[i].value);
                const desc = descriptions[i].value || 'Carga ' + (i+1);
                
                if (pos && weight) {
                    totalMoment += pos * weight;
                    concentratedWeight += weight;
                    loadDetails.push({ position: pos, weight: weight, description: desc });
                }
            }

            let centerOfGravity;
            let calculationMethod = '';

            // Determinar m√©todo de c√°lculo del CG
            if (manualCG && manualCG > 0) {
                centerOfGravity = manualCG;
                calculationMethod = 'Centro de Gravedad Especificado Manualmente';
            } else if (concentratedWeight > 0) {
                // Peso distribuido restante
                const distributedWeight = totalWeight - concentratedWeight;
                const distributedMoment = (totalLength / 2) * distributedWeight;

                const totalMomentFinal = totalMoment + distributedMoment;
                centerOfGravity = totalMomentFinal / totalWeight;
                calculationMethod = 'Calculado con Cargas Concentradas + Peso Distribuido';
            } else {
                // Viga uniforme por defecto
                centerOfGravity = totalLength / 2;
                calculationMethod = 'Viga Uniforme (Centro Geom√©trico)';
            }

            // Validaci√≥n del CG
            if (centerOfGravity <= 0 || centerOfGravity >= totalLength) {
                alert('‚ö†Ô∏è ADVERTENCIA: Centro de gravedad fuera de los l√≠mites de la estructura');
            }

            // Puntos de izaje optimizados seg√∫n el tipo de estructura
            let liftSpan;
            switch(structureType) {
                case 'beam':
                    liftSpan = totalLength * 0.293; // Puntos de Airy
                    break;
                case 'equipment':
                    liftSpan = totalLength * 0.25; // M√°s conservador para equipos
                    break;
                case 'tank':
                    liftSpan = totalLength * 0.2; // Muy conservador para tanques
                    break;
                default:
                    liftSpan = totalLength * 0.3;
            }

            const liftPoint1 = Math.max(0.05 * totalLength, centerOfGravity - liftSpan/2);
            const liftPoint2 = Math.min(0.95 * totalLength, centerOfGravity + liftSpan/2);

            // C√°lculo de reacciones en puntos de izaje
            const d1 = liftPoint2 - liftPoint1;
            const reaction1 = totalWeight * (liftPoint2 - centerOfGravity) / d1;
            const reaction2 = totalWeight * (centerOfGravity - liftPoint1) / d1;

            // C√°lculo de momentos flexionantes m√°ximos
            const maxMoment1 = Math.abs(reaction1 * (centerOfGravity - liftPoint1));
            const maxMoment2 = Math.abs(reaction2 * (liftPoint2 - centerOfGravity));

            let resultHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">üìê An√°lisis Completo de Centro de Gravedad</div>' +
                    '<div>' + new Date().toLocaleDateString() + '</div>' +
                '</div>' +
                '<div class="alert alert-warning">' +
                    '<span class="alert-icon">üî¨</span>' +
                    '<div><strong>M√©todo de C√°lculo:</strong> ' + calculationMethod + '</div>' +
                '</div>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">üéØ Centro de Gravedad</div>' +
                        '<div class="result-value">' + centerOfGravity.toFixed(3) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Peso Concentrado Total</div>' +
                        '<div class="result-value">' + concentratedWeight.toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Peso Distribuido</div>' +
                        '<div class="result-value">' + (totalWeight - concentratedWeight).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">üìç Punto de Izaje 1</div>' +
                        '<div class="result-value">' + liftPoint1.toFixed(3) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">üìç Punto de Izaje 2</div>' +
                        '<div class="result-value">' + liftPoint2.toFixed(3) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">‚öñÔ∏è Reacci√≥n Punto 1</div>' +
                        '<div class="result-value">' + Math.round(reaction1).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">‚öñÔ∏è Reacci√≥n Punto 2</div>' +
                        '<div class="result-value">' + Math.round(reaction2).toLocaleString() + '<span class="result-unit">kg</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">üìè Separaci√≥n de Puntos</div>' +
                        '<div class="result-value">' + (liftPoint2 - liftPoint1).toFixed(2) + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">üìä Momento M√°ximo</div>' +
                        '<div class="result-value">' + Math.max(maxMoment1, maxMoment2).toLocaleString() + '<span class="result-unit">kg‚ãÖm</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">% Desbalance</div>' +
                        '<div class="result-value">' + Math.abs(((reaction1-reaction2)/totalWeight)*100).toFixed(1) + '<span class="result-unit">%</span></div>' +
                    '</div>' +
                '</div>' +
                '<div class="calculation-steps">' +
                    '<h4>üßÆ Pasos de C√°lculo del Centro de Gravedad</h4>' +
                    '<div class="step">' +
                        '<span class="step-number">1.</span>' +
                        'Momento Total = Œ£(Peso √ó Distancia) para todas las cargas' +
                    '</div>' +
                    '<div class="formula">' +
                        'Momento = ' + totalMoment.toLocaleString() + ' kg‚ãÖm (cargas concentradas) + ' + ((totalWeight - concentratedWeight) * totalLength/2).toLocaleString() + ' kg‚ãÖm (distribuido)' +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">2.</span>' +
                        'Centro de Gravedad = Momento Total / Peso Total' +
                    '</div>' +
                    '<div class="formula">' +
                        'CG = ' + centerOfGravity.toFixed(3) + ' m desde extremo izquierdo' +
                    '</div>' +
                    '<div class="step">' +
                        '<span class="step-number">3.</span>' +
                        'Reacciones: R‚ÇÅ = W√ó(P‚ÇÇ-CG)/(P‚ÇÇ-P‚ÇÅ) | R‚ÇÇ = W√ó(CG-P‚ÇÅ)/(P‚ÇÇ-P‚ÇÅ)' +
                    '</div>' +
                    '<div class="formula">' +
                        'R‚ÇÅ = ' + Math.round(reaction1).toLocaleString() + ' kg | R‚ÇÇ = ' + Math.round(reaction2).toLocaleString() + ' kg' +
                    '</div>' +
                '</div>';

            // Mostrar tabla de cargas concentradas si existen
            if (loadDetails.length > 0) {
                resultHtml += '<h4>üìã Detalle de Cargas Concentradas</h4>' +
                    '<div class="table-responsive">' +
                    '<table class="reference-table">' +
                        '<thead>' +
                            '<tr>' +
                                '<th>Descripci√≥n</th>' +
                                '<th>Posici√≥n (m)</th>' +
                                '<th>Peso (kg)</th>' +
                                '<th>Momento (kg‚ãÖm)</th>' +
                                '<th class="mobile-hidden">% del Total</th>' +
                            '</tr>' +
                        '</thead>' +
                        '<tbody>';

                for (let i = 0; i < loadDetails.length; i++) {
                    const load = loadDetails[i];
                    resultHtml += '<tr>' +
                        '<td>' + load.description + '</td>' +
                        '<td>' + load.position.toFixed(2) + '</td>' +
                        '<td>' + load.weight.toLocaleString() + '</td>' +
                        '<td>' + (load.position * load.weight).toLocaleString() + '</td>' +
                        '<td class="mobile-hidden">' + ((load.weight/totalWeight)*100).toFixed(1) + '%</td>' +
                    '</tr>';
                }

                resultHtml += '</tbody></table></div>';
            }

            // Evaluaci√≥n de la configuraci√≥n
            const balanceQuality = Math.abs(((reaction1-reaction2)/totalWeight)*100);
            let structuralStatus = '';
            
            if (balanceQuality <= 5) {
                structuralStatus = 'CONFIGURACI√ìN √ìPTIMA';
                resultHtml += '<div class="alert alert-success">' +
                    '<span class="alert-icon">‚úÖ</span>' +
                    '<div>' +
                        '<strong>CONFIGURACI√ìN √ìPTIMA DE IZAJE</strong><br>' +
                        'Excelente balance de cargas (' + balanceQuality.toFixed(1) + '% desbalance).<br>' +
                        'üìç Puntos recomendados: ' + liftPoint1.toFixed(2) + 'm - ' + liftPoint2.toFixed(2) + 'm<br>' +
                        '‚öñÔ∏è Distribuci√≥n: ' + ((reaction1/totalWeight)*100).toFixed(1) + '% - ' + ((reaction2/totalWeight)*100).toFixed(1) + '%' +
                    '</div>' +
                '</div>';
            } else if (balanceQuality <= 10) {
                structuralStatus = 'CONFIGURACI√ìN ACEPTABLE';
                resultHtml += '<div class="alert alert-warning">' +
                    '<span class="alert-icon">‚ö†Ô∏è</span>' +
                    '<div>' +
                        '<strong>CONFIGURACI√ìN ACEPTABLE - VERIFICAR</strong><br>' +
                        'Desbalance moderado (' + balanceQuality.toFixed(1) + '%). Verificar capacidad de eslingas.<br>' +
                        'Considerar ajustar puntos de izaje si es posible.' +
                    '</div>' +
                '</div>';
            } else {
                structuralStatus = 'DESBALANCE CR√çTICO';
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">‚ùå</span>' +
                    '<div>' +
                        '<strong>DESBALANCE CR√çTICO - RECONFIGURAR</strong><br>' +
                        'Alto desbalance (' + balanceQuality.toFixed(1) + '%). Riesgo de inclinaci√≥n excesiva.<br>' +
                        'Revisar distribuci√≥n de cargas o usar m√°s puntos de izaje.' +
                    '</div>' +
                '</div>';
            }

            resultHtml += '</div>';

            // Trackear resultado del an√°lisis
            trackEvent('safety_evaluation', 'Structural_Analysis', structuralStatus, balanceQuality);

            // Guardar resultados
            analysisResults.structural = {
                totalLength: totalLength,
                totalWeight: totalWeight,
                centerOfGravity: centerOfGravity,
                concentratedWeight: concentratedWeight,
                distributedWeight: totalWeight - concentratedWeight,
                liftPoint1: liftPoint1,
                liftPoint2: liftPoint2,
                reaction1: reaction1,
                reaction2: reaction2,
                loadDetails: loadDetails,
                structureType: structureType,
                calculationMethod: calculationMethod,
                balanceQuality: balanceQuality,
                structuralStatus: structuralStatus
            };

            document.getElementById('structuralAnalysisResult').innerHTML = resultHtml;
        }

        function calculateStability() {
            const base = parseFloat(document.getElementById('craneBase').value);
            const craneWeight = parseFloat(document.getElementById('craneWeight').value);
            const cgHeight = parseFloat(document.getElementById('craneCGHeight').value);
            const windSpeed = parseFloat(document.getElementById('windSpeed').value);
            const windArea = parseFloat(document.getElementById('windArea').value);
            const shapeCoeff = parseFloat(document.getElementById('shapeCoeff').value);

            if (!base || !craneWeight) {
                alert('Complete los datos b√°sicos de la gr√∫a');
                return;
            }

            // Trackear el c√°lculo
            trackCalculation('stability_analysis', {
                base,
                craneWeight,
                cgHeight,
                windSpeed,
                windArea,
                shapeCoeff
            });

            // C√°lculo de presi√≥n de viento (seg√∫n normativa)
            const windPressure = 0.613 * Math.pow(windSpeed/3.6, 2); // Pa
            const windForce = windPressure * windArea * shapeCoeff; // N
            const windMoment = (windForce * cgHeight) / 1000; // kN‚ãÖm

            // Momento estabilizador
            const stabilizingMoment = (craneWeight * base * 9.81) / 2000; // kN‚ãÖm

            // Factor de estabilidad
            const stabilityFactor = stabilizingMoment / windMoment;

            let resultHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">An√°lisis de Estabilidad</div>' +
                    '<div>' + new Date().toLocaleDateString() + '</div>' +
                '</div>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">Presi√≥n de Viento</div>' +
                        '<div class="result-value">' + windPressure.toFixed(0) + '<span class="result-unit">Pa</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Fuerza de Viento</div>' +
                        '<div class="result-value">' + (windForce/1000).toFixed(1) + '<span class="result-unit">kN</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Momento Volcante</div>' +
                        '<div class="result-value">' + windMoment.toFixed(1) + '<span class="result-unit">kN‚ãÖm</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Momento Estabilizador</div>' +
                        '<div class="result-value">' + stabilizingMoment.toFixed(1) + '<span class="result-unit">kN‚ãÖm</span></div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Factor de Estabilidad</div>' +
                        '<div class="result-value">' + stabilityFactor.toFixed(2) + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Base de Apoyo</div>' +
                        '<div class="result-value">' + base + '<span class="result-unit">m</span></div>' +
                    '</div>' +
                '</div>' +
                '<div class="formula">' +
                    'Factor de Estabilidad = Momento Estabilizador / Momento Volcante = ' + stabilityFactor.toFixed(2) +
                '</div>';

            let stabilityStatus = '';
            if (stabilityFactor >= 2.0) {
                stabilityStatus = 'ESTABILIDAD EXCELENTE';
                resultHtml += '<div class="alert alert-success">' +
                    '<span class="alert-icon">‚úÖ</span>' +
                    '<div>' +
                        '<strong>ESTABILIDAD EXCELENTE</strong><br>' +
                        'Factor de estabilidad superior a 2.0. Operaci√≥n segura bajo las condiciones especificadas.' +
                    '</div>' +
                '</div>';
            } else if (stabilityFactor >= 1.5) {
                stabilityStatus = 'ESTABILIDAD ACEPTABLE';
                resultHtml += '<div class="alert alert-warning">' +
                    '<span class="alert-icon">‚ö†Ô∏è</span>' +
                    '<div>' +
                        '<strong>ESTABILIDAD ACEPTABLE - MONITOREAR CONDICIONES</strong><br>' +
                        'Verificar continuamente condiciones de viento durante la operaci√≥n.' +
                    '</div>' +
                '</div>';
            } else {
                stabilityStatus = 'RIESGO DE VOLCAMIENTO';
                resultHtml += '<div class="alert alert-danger">' +
                    '<span class="alert-icon">‚ùå</span>' +
                    '<div>' +
                        '<strong>RIESGO DE VOLCAMIENTO - OPERACI√ìN PROHIBIDA</strong><br>' +
                        'Factor de estabilidad insuficiente. Mejorar base de apoyo o suspender operaci√≥n.' +
                    '</div>' +
                '</div>';
            }

            resultHtml += '</div>';

            // Trackear resultado del an√°lisis
            trackEvent('safety_evaluation', 'Stability_Analysis', stabilityStatus, stabilityFactor);

            // Guardar resultados
            analysisResults.stability = {
                base: base, 
                craneWeight: craneWeight, 
                cgHeight: cgHeight, 
                windSpeed: windSpeed, 
                windArea: windArea,
                windPressure: windPressure, 
                windForce: windForce, 
                windMoment: windMoment, 
                stabilizingMoment: stabilizingMoment, 
                stabilityFactor: stabilityFactor,
                stabilityStatus: stabilityStatus
            };

            document.getElementById('stabilityResult').innerHTML = resultHtml;
        }

        function generateFullReport() {
            const projectName = document.getElementById('projectName').value || 'Proyecto de Izaje';
            const engineerName = document.getElementById('engineerName').value || 'Ingeniero Responsable';
            const companyName = document.getElementById('companyName').value || 'Empresa Minera';
            const operationDate = document.getElementById('operationDate').value || new Date().toISOString().split('T')[0];

            // Trackear generaci√≥n de reporte
            trackEvent('report_preview', 'Reports', 'Full_Report_Preview');

            let reportHtml = '<div class="result-container">' +
                '<div class="result-header">' +
                    '<div class="result-title">REPORTE T√âCNICO DE OPERACI√ìN DE IZAJE</div>' +
                    '<div>Documento Oficial</div>' +
                '</div>' +
                '<h3>Informaci√≥n del Proyecto</h3>' +
                '<div class="result-grid">' +
                    '<div class="result-item">' +
                        '<div class="result-label">Proyecto</div>' +
                        '<div class="result-value">' + projectName + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Empresa</div>' +
                        '<div class="result-value">' + companyName + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Ingeniero Responsable</div>' +
                        '<div class="result-value">' + engineerName + '</div>' +
                    '</div>' +
                    '<div class="result-item">' +
                        '<div class="result-label">Fecha de Operaci√≥n</div>' +
                        '<div class="result-value">' + new Date(operationDate).toLocaleDateString() + '</div>' +
                    '</div>' +
                '</div>';

            // Incluir resumen de todos los an√°lisis realizados
            if (analysisResults.crane) {
                reportHtml += '<h3>Resumen de An√°lisis de Gr√∫a</h3>' +
                    '<p><strong>Utilizaci√≥n:</strong> ' + analysisResults.crane.utilizationPercentage.toFixed(1) + '% | ' +
                    '<strong>Factor de Seguridad:</strong> ' + analysisResults.crane.safetyFactor + ' | ' +
                    '<strong>Capacidad Efectiva:</strong> ' + Math.round(analysisResults.crane.effectiveCapacity).toLocaleString() + ' kg | ' +
                    '<strong>Estado:</strong> ' + analysisResults.crane.safetyStatus + '</p>';
            }

            if (analysisResults.sling) {
                reportHtml += '<h3>Resumen de An√°lisis de Eslingas</h3>' +
                    '<p><strong>Tensi√≥n por Ramal:</strong> ' + Math.round(analysisResults.sling.tensionPerLeg).toLocaleString() + ' kg | ' +
                    '<strong>Utilizaci√≥n:</strong> ' + analysisResults.sling.utilizationSling.toFixed(1) + '% | ' +
                    '<strong>Material:</strong> ' + analysisResults.sling.material + ' | ' +
                    '<strong>Estado:</strong> ' + analysisResults.sling.slingStatus + '</p>';
            }

            if (analysisResults.structural) {
                reportHtml += '<h3>Resumen de An√°lisis Estructural</h3>' +
                    '<p><strong>Centro de Gravedad:</strong> ' + analysisResults.structural.centerOfGravity.toFixed(2) + ' m | ' +
                    '<strong>Puntos de Izaje:</strong> ' + analysisResults.structural.liftPoint1.toFixed(2) + ' m - ' + analysisResults.structural.liftPoint2.toFixed(2) + ' m | ' +
                    '<strong>Estado:</strong> ' + analysisResults.structural.structuralStatus + '</p>';
            }

            if (analysisResults.stability) {
                reportHtml += '<h3>Resumen de An√°lisis de Estabilidad</h3>' +
                    '<p><strong>Factor de Estabilidad:</strong> ' + analysisResults.stability.stabilityFactor.toFixed(2) + ' | ' +
                    '<strong>Velocidad de Viento:</strong> ' + analysisResults.stability.windSpeed + ' km/h | ' +
                    '<strong>Estado:</strong> ' + analysisResults.stability.stabilityStatus + '</p>';
            }

            reportHtml += '<div class="alert alert-success">' +
                '<span class="alert-icon">üìã</span>' +
                '<div>' +
                    '<strong>REPORTE GENERADO EXITOSAMENTE</strong><br>' +
                    'Este reporte cumple con las normativas DS 132, ANSI B30 e ISO 4301. ' +
                    'V√°lido para presentaci√≥n a autoridades mineras.<br>' +
                    'Desarrollado por <strong>RaulPivetA.</strong>' +
                '</div>' +
            '</div>' +
        '</div>';

            document.getElementById('reportPreview').innerHTML = reportHtml;
        }

        function clearCraneInputs() {
            document.getElementById('craneLoadWeight').value = '';
            document.getElementById('craneRadius').value = '';
            document.getElementById('liftHeight').value = '';
            document.getElementById('craneCapacityNominal').value = '';
            document.getElementById('craneAnalysisResult').innerHTML = '';
            
            // Trackear limpieza de datos
            trackEvent('clear_inputs', 'Data_Management', 'Crane_Inputs_Cleared');
        }

        function generateSlingReport() {
            if (!analysisResults.sling) {
                alert('Primero debe realizar el c√°lculo de eslingas');
                return;
            }
            
            generateProfessionalPDF('sling');
        }

        function exportToExcel() {
            generateProfessionalExcel();
        }

        function generateProfessionalPDF(reportType = 'complete') {
            // Verificar que hay datos para generar reporte
            if (!analysisResults.crane && !analysisResults.sling && !analysisResults.structural && !analysisResults.stability) {
                alert('‚ö†Ô∏è Debe realizar al menos un an√°lisis antes de generar el reporte.');
                return;
            }

            // Trackear inicio de generaci√≥n PDF
            trackExport('professional_report', 'PDF');

            // Cargar jsPDF din√°micamente
            if (typeof window.jsPDF === 'undefined') {
                // Mostrar indicador de carga
                const loadingHtml = '<div class="alert alert-warning">' +
                    '<span class="alert-icon"><div class="loading"></div></span>' +
                    '<div><strong>Generando reporte PDF...</strong><br>Cargando librer√≠as necesarias, por favor espere.</div>' +
                '</div>';
                document.getElementById('reportPreview').innerHTML = loadingHtml;

                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                script.onload = function() {
                    setTimeout(() => generatePDFContent(reportType), 100);
                };
                script.onerror = function() {
                    alert('Error al cargar la librer√≠a PDF. Verifique su conexi√≥n a internet.');
                };
                document.head.appendChild(script);
            } else {
                generatePDFContent(reportType);
            }
        }

        function generatePDFContent(reportType) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Configuraci√≥n del documento
                const pageWidth = 210;
                const pageHeight = 297;
                const margin = 15;
                const contentWidth = pageWidth - (margin * 2);
                const footerHeight = 25;
                const usableHeight = pageHeight - footerHeight;
                let yPosition = margin;

                // Colores corporativos
                const primaryColor = [231, 76, 60];
                const secondaryColor = [44, 62, 80];
                const accentColor = [149, 165, 166];

                // HEADER CORPORATIVO
                doc.setFillColor(...primaryColor);
                doc.rect(0, 0, pageWidth, 32, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text('‚õèÔ∏è SISTEMA DE C√ÅLCULOS DE IZAJE', margin, 11);
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text('Miner√≠a Norte de Chile - An√°lisis Profesional de Operaciones de Carga', margin, 20);
                doc.text('Certificado ISO 9001:2015 | Cumple DS 132, ANSI B30, ISO 4301', margin, 27);

                doc.setDrawColor(...secondaryColor);
                doc.setLineWidth(1);
                doc.line(0, 32, pageWidth, 32);
                
                yPosition = 38;

                // INFORMACI√ìN DEL PROYECTO
                doc.setTextColor(...secondaryColor);
                doc.setFontSize(13);
                doc.setFont('helvetica', 'bold');
                doc.text('REPORTE T√âCNICO DE OPERACI√ìN DE IZAJE', margin, yPosition);
                yPosition += 5;

                const projectBoxHeight = 18;
                doc.setDrawColor(...accentColor);
                doc.setLineWidth(0.5);
                doc.rect(margin, yPosition, contentWidth, projectBoxHeight);
                
                doc.setFillColor(248, 249, 250);
                doc.rect(margin, yPosition, contentWidth, 3.5, 'F');
                
                doc.setTextColor(...primaryColor);
                doc.setFontSize(7);
                doc.setFont('helvetica', 'bold');
                doc.text('INFORMACI√ìN DEL PROYECTO', margin + 2, yPosition + 2.5);
                
                yPosition += 5;
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                
                const projectName = document.getElementById('projectName').value || 'Proyecto de Izaje Minero';
                const engineerName = document.getElementById('engineerName').value || 'Ingeniero Responsable';
                const companyName = document.getElementById('companyName').value || 'Empresa Minera Norte';
                const operationDate = document.getElementById('operationDate').value || new Date().toISOString().split('T')[0];
                
                // Primera fila
                doc.text('Proyecto:', margin + 2, yPosition);
                doc.setFont('helvetica', 'bold');
                const shortProjectName = projectName.length > 30 ? projectName.substring(0, 27) + '...' : projectName;
                doc.text(shortProjectName, margin + 17, yPosition);
                
                doc.setFont('helvetica', 'normal');
                doc.text('Empresa:', margin + 95, yPosition);
                doc.setFont('helvetica', 'bold');
                const shortCompanyName = companyName.length > 24 ? companyName.substring(0, 21) + '...' : companyName;
                doc.text(shortCompanyName, margin + 108, yPosition);
                yPosition += 3;
                
                // Segunda fila
                doc.setFont('helvetica', 'normal');
                doc.text('Ingeniero:', margin + 2, yPosition);
                doc.setFont('helvetica', 'bold');
                const shortEngineerName = engineerName.length > 28 ? engineerName.substring(0, 25) + '...' : engineerName;
                doc.text(shortEngineerName, margin + 17, yPosition);
                
                doc.setFont('helvetica', 'normal');
                doc.text('Fecha:', margin + 95, yPosition);
                doc.setFont('helvetica', 'bold');
                doc.text(new Date(operationDate).toLocaleDateString('es-ES'), margin + 105, yPosition);
                yPosition += 3;
                
                // Tercera fila
                doc.setFont('helvetica', 'normal');
                doc.text('Generado:', margin + 2, yPosition);
                doc.setFont('helvetica', 'bold');
                doc.text(new Date().toLocaleDateString('es-ES') + ' ' + new Date().toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'}), margin + 17, yPosition);
                
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(6);
                doc.setTextColor(100, 100, 100);
                doc.text('Desarrollado por: RaulPivetA.', margin + 95, yPosition);
                
                yPosition += 10;

                // RESUMEN EJECUTIVO
                if (yPosition > usableHeight - 50) {
                    doc.addPage();
                    yPosition = margin + 10;
                }

                doc.setTextColor(...primaryColor);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text('RESUMEN EJECUTIVO', margin, yPosition);
                yPosition += 5;

                let analysisCount = 0;
                let safetySummary = [];

                // An√°lisis de Gr√∫a
                if (analysisResults.crane) {
                    analysisCount++;
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'bold');
                    doc.text('‚Ä¢ An√°lisis de Capacidad de Gr√∫a:', margin + 2, yPosition);
                    yPosition += 3.5;
                    
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(8);
                    const craneText = '  Utilizaci√≥n: ' + analysisResults.crane.utilizationPercentage.toFixed(1) + '% | ' +
                        'Factor Seguridad: ' + analysisResults.crane.safetyFactor + ' | ' +
                        'Capacidad Efectiva: ' + Math.round(analysisResults.crane.effectiveCapacity).toLocaleString() + ' kg';
                    doc.text(craneText, margin + 2, yPosition);
                    yPosition += 3.5;
                    
                    if (analysisResults.crane.utilizationPercentage <= 75) {
                        safetySummary.push('Gr√∫a: OPERACI√ìN SEGURA');
                        doc.setTextColor(21, 87, 36);
                    } else if (analysisResults.crane.utilizationPercentage <= 85) {
                        safetySummary.push('Gr√∫a: PRECAUCI√ìN');
                        doc.setTextColor(133, 100, 4);
                    } else {
                        safetySummary.push('Gr√∫a: RIESGO ALTO');
                        doc.setTextColor(114, 28, 36);
                    }
                    doc.text('  Estado: ' + safetySummary[safetySummary.length - 1], margin + 2, yPosition);
                    yPosition += 5;
                }

                // An√°lisis de Eslingas
                if (analysisResults.sling) {
                    if (yPosition > usableHeight - 30) {
                        doc.addPage();
                        yPosition = margin + 10;
                    }
                    
                    analysisCount++;
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'bold');
                    doc.text('‚Ä¢ Ingenier√≠a de Eslingas:', margin + 2, yPosition);
                    yPosition += 3.5;
                    
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(8);
                    const slingText = '  Tensi√≥n por Ramal: ' + Math.round(analysisResults.sling.tensionPerLeg).toLocaleString() + ' kg | ' +
                        'Utilizaci√≥n: ' + analysisResults.sling.utilizationSling.toFixed(1) + '% | ' +
                        'Material: ' + analysisResults.sling.material;
                    doc.text(slingText, margin + 2, yPosition);
                    yPosition += 3.5;
                    
                    if (analysisResults.sling.angle < 30) {
                        safetySummary.push('Eslingas: √ÅNGULO CR√çTICO');
                        doc.setTextColor(114, 28, 36);
                    } else if (analysisResults.sling.utilizationSling <= 80) {
                        safetySummary.push('Eslingas: CONFIGURACI√ìN √ìPTIMA');
                        doc.setTextColor(21, 87, 36);
                    } else if (analysisResults.sling.utilizationSling <= 95) {
                        safetySummary.push('Eslingas: UTILIZACI√ìN ALTA');
                        doc.setTextColor(133, 100, 4);
                    } else {
                        safetySummary.push('Eslingas: CAPACIDAD INSUFICIENTE');
                        doc.setTextColor(114, 28, 36);
                    }
                    doc.text('  Estado: ' + safetySummary[safetySummary.length - 1], margin + 2, yPosition);
                    yPosition += 5;
                }

                // An√°lisis Estructural
                if (analysisResults.structural) {
                    if (yPosition > usableHeight - 30) {
                        doc.addPage();
                        yPosition = margin + 10;
                    }
                    
                    analysisCount++;
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'bold');
                    doc.text('‚Ä¢ Centro de Gravedad y Estructura:', margin + 2, yPosition);
                    yPosition += 3.5;
                    
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(8);
                    const structText = '  Centro de Gravedad: ' + analysisResults.structural.centerOfGravity.toFixed(2) + ' m | ' +
                        'Puntos de Izaje: ' + analysisResults.structural.liftPoint1.toFixed(2) + 'm - ' + analysisResults.structural.liftPoint2.toFixed(2) + 'm';
                    doc.text(structText, margin + 2, yPosition);
                    yPosition += 3.5;
                    
                    if (analysisResults.structural.balanceQuality <= 5) {
                        safetySummary.push('Estructura: BALANCE √ìPTIMO');
                        doc.setTextColor(21, 87, 36);
                    } else if (analysisResults.structural.balanceQuality <= 10) {
                        safetySummary.push('Estructura: BALANCE ACEPTABLE');
                        doc.setTextColor(133, 100, 4);
                    } else {
                        safetySummary.push('Estructura: DESBALANCE CR√çTICO');
                        doc.setTextColor(114, 28, 36);
                    }
                    doc.text('  Estado: ' + safetySummary[safetySummary.length - 1], margin + 2, yPosition);
                    yPosition += 5;
                }

                // CONCLUSI√ìN GENERAL
                if (yPosition > usableHeight - 25) {
                    doc.addPage();
                    yPosition = margin + 10;
                }
                
                yPosition += 2;
                doc.setTextColor(...primaryColor);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text('CONCLUSI√ìN GENERAL:', margin, yPosition);
                yPosition += 5;

                let generalStatus = 'OPERACI√ìN AUTORIZADA';
                let statusColor = [21, 87, 36];
                
                if (safetySummary.some(s => s.includes('CR√çTICO') || s.includes('INSUFICIENTE') || s.includes('RIESGO ALTO'))) {
                    generalStatus = 'OPERACI√ìN PROHIBIDA - REVISAR PAR√ÅMETROS';
                    statusColor = [114, 28, 36];
                } else if (safetySummary.some(s => s.includes('PRECAUCI√ìN') || s.includes('ALTA'))) {
                    generalStatus = 'OPERACI√ìN CONDICIONAL - SUPERVISI√ìN REQUERIDA';
                    statusColor = [133, 100, 4];
                }

                doc.setFillColor(...statusColor);
                doc.rect(margin, yPosition - 1, contentWidth, 6, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text('‚úì ' + generalStatus, margin + 2, yPosition + 2.5);
                yPosition += 10;

                // Nueva p√°gina para detalles t√©cnicos
                if (yPosition > usableHeight - 40) {
                    doc.addPage();
                    yPosition = margin + 10;
                }

                // DETALLES T√âCNICOS COMPLETOS
                doc.setTextColor(...secondaryColor);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text('DETALLES T√âCNICOS COMPLETOS', margin, yPosition);
                yPosition += 6;

                // Agregar cada an√°lisis detallado
                if (analysisResults.crane) {
                    yPosition = addCraneDetailsToPage(doc, yPosition, margin, contentWidth, primaryColor, secondaryColor, usableHeight);
                }

                if (analysisResults.sling) {
                    if (yPosition > usableHeight - 50) {
                        doc.addPage();
                        yPosition = margin + 10;
                    }
                    yPosition = addSlingDetailsToPage(doc, yPosition, margin, contentWidth, primaryColor, secondaryColor, usableHeight);
                }

                if (analysisResults.structural) {
                    if (yPosition > usableHeight - 50) {
                        doc.addPage();
                        yPosition = margin + 10;
                    }
                    yPosition = addStructuralDetailsToPage(doc, yPosition, margin, contentWidth, primaryColor, secondaryColor, usableHeight);
                }

                // FOOTER EN TODAS LAS P√ÅGINAS
                const totalPages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    
                    const footerY = pageHeight - 18;
                    doc.setDrawColor(...accentColor);
                    doc.setLineWidth(0.3);
                    doc.line(margin, footerY, pageWidth - margin, footerY);
                    
                    doc.setTextColor(...accentColor);
                    doc.setFontSize(6);
                    doc.setFont('helvetica', 'normal');
                    doc.text('Sistema de C√°lculos de Izaje - Miner√≠a Norte Chile | Certificado ISO 9001:2015', margin, footerY + 3);
                    
                    doc.text('Cumple normativas DS 132, ANSI/ASME B30, ISO 4301 | P√°gina ' + i + ' de ' + totalPages, margin, footerY + 6);
                    
                    doc.text('Generado: ' + new Date().toLocaleString('es-ES') + ' | V√°lido para autoridades mineras', margin, footerY + 9);
                    
                    doc.setFontSize(6);
                    doc.setTextColor(80, 80, 80);
                    doc.setFont('helvetica', 'bold');
                    doc.text('Desarrollado por: RaulPivetA.', margin, footerY + 12);
                    
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(5);
                    doc.setTextColor(120, 120, 120);
                    doc.text('¬© 2025', margin + 55, footerY + 12);
                }

                // Generar nombre del archivo
                const fileName = 'Reporte_Izaje_' + (projectName.replace(/\s+/g, '_')) + '_' + 
                    new Date().toISOString().split('T')[0] + '.pdf';

                // Guardar PDF
                doc.save(fileName);
                
                // Trackear √©xito de exportaci√≥n
                trackEvent('export_success', 'PDF_Export', fileName, analysisCount);
                
                // Mostrar mensaje de √©xito
                alert('‚úÖ Reporte PDF generado exitosamente!\n\n' +
                    'üìÑ Archivo: ' + fileName + '\n' +
                    'üìä An√°lisis incluidos: ' + analysisCount + '\n' +
                    'üéØ Estado general: ' + generalStatus + '\n\n' +
                    'üë®‚Äçüíª Desarrollado por: RaulPivetA.\n' +
                    'üèÜ Cumple est√°ndares profesionales para autoridades mineras.\n' +
                    'üìã V√°lido seg√∫n normativas DS 132, ANSI B30, ISO 4301');

            } catch (error) {
                console.error('Error generando PDF:', error);
                alert('‚ùå Error al generar el PDF. Por favor, intente nuevamente.\n\nDetalle del error: ' + error.message);
                trackEvent('export_error', 'PDF_Export', error.message);
            }
        }

        function addCraneDetailsToPage(doc, yPos, margin, contentWidth, primaryColor, secondaryColor, usableHeight) {
            if (yPos > usableHeight - 60) {
                doc.addPage();
                yPos = margin + 10;
            }

            doc.setTextColor(...primaryColor);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('AN√ÅLISIS DETALLADO DE GR√öA', margin, yPos);
            yPos += 6;

            doc.setTextColor(0, 0, 0);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');

            const craneData = [
                ['Par√°metro', 'Valor', 'Unidad'],
                ['Peso de Carga', analysisResults.crane.loadWeight.toLocaleString(), 'kg'],
                ['Radio de Operaci√≥n', analysisResults.crane.radius.toString(), 'm'],
                ['Capacidad Nominal', analysisResults.crane.capacity.toLocaleString(), 'kg'],
                ['Capacidad Efectiva', Math.round(analysisResults.crane.effectiveCapacity).toLocaleString(), 'kg'],
                ['Capacidad Requerida', Math.round(analysisResults.crane.requiredCapacity).toLocaleString(), 'kg'],
                ['Utilizaci√≥n', analysisResults.crane.utilizationPercentage.toFixed(1), '%'],
                ['Factor de Seguridad', analysisResults.crane.safetyFactor.toString(), '-'],
                ['Momento de Carga', analysisResults.crane.loadMoment.toLocaleString(), 'kg‚ãÖm'],
                ['Ratio de Estabilidad', analysisResults.crane.stabilityRatio.toFixed(2), '-']
            ];

            yPos = drawTable(doc, craneData, margin, yPos, contentWidth, primaryColor, 4.5);
            return yPos + 6;
        }

        function addSlingDetailsToPage(doc, yPos, margin, contentWidth, primaryColor, secondaryColor, usableHeight) {
            if (yPos > usableHeight - 70) {
                doc.addPage();
                yPos = margin + 10;
            }

            doc.setTextColor(...primaryColor);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('AN√ÅLISIS DETALLADO DE ESLINGAS', margin, yPos);
            yPos += 6;

            doc.setTextColor(0, 0, 0);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');

            const slingData = [
                ['Par√°metro', 'Valor', 'Unidad'],
                ['Peso Total', analysisResults.sling.weight.toLocaleString(), 'kg'],
                ['N√∫mero de Ramales', analysisResults.sling.legs.toString(), '-'],
                ['√Ångulo de Eslinga', analysisResults.sling.angle.toString(), '¬∞'],
                ['Di√°metro', analysisResults.sling.diameter.toString(), 'mm'],
                ['Carga por Ramal', Math.round(analysisResults.sling.weight / analysisResults.sling.legs).toLocaleString(), 'kg'],
                ['Tensi√≥n por Ramal', Math.round(analysisResults.sling.tensionPerLeg).toLocaleString(), 'kg'],
                ['Capacidad de Trabajo', Math.round(analysisResults.sling.workingLoad).toLocaleString(), 'kg'],
                ['Resistencia a Rotura', analysisResults.sling.breakingStrength.toLocaleString(), 'kg'],
                ['Utilizaci√≥n', analysisResults.sling.utilizationSling.toFixed(1), '%'],
                ['Eficiencia Angular', analysisResults.sling.angleEfficiency.toFixed(3), '-'],
                ['Factor de Seguridad', analysisResults.sling.safetyFactor.toString(), '-']
            ];

            yPos = drawTable(doc, slingData, margin, yPos, contentWidth, primaryColor, 4.5);
            return yPos + 6;
        }

        function addStructuralDetailsToPage(doc, yPos, margin, contentWidth, primaryColor, secondaryColor, usableHeight) {
            if (yPos > usableHeight - 70) {
                doc.addPage();
                yPos = margin + 10;
            }

            doc.setTextColor(...primaryColor);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('AN√ÅLISIS ESTRUCTURAL Y CENTRO DE GRAVEDAD', margin, yPos);
            yPos += 6;

            doc.setTextColor(0, 0, 0);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');

            const structData = [
                ['Par√°metro', 'Valor', 'Unidad'],
                ['Longitud Total', analysisResults.structural.totalLength.toString(), 'm'],
                ['Peso Total', analysisResults.structural.totalWeight.toLocaleString(), 'kg'],
                ['Centro de Gravedad', analysisResults.structural.centerOfGravity.toFixed(3), 'm'],
                ['Peso Concentrado', analysisResults.structural.concentratedWeight.toLocaleString(), 'kg'],
                ['Peso Distribuido', analysisResults.structural.distributedWeight.toLocaleString(), 'kg'],
                ['Punto de Izaje 1', analysisResults.structural.liftPoint1.toFixed(3), 'm'],
                ['Punto de Izaje 2', analysisResults.structural.liftPoint2.toFixed(3), 'm'],
                ['Reacci√≥n Punto 1', Math.round(analysisResults.structural.reaction1).toLocaleString(), 'kg'],
                ['Reacci√≥n Punto 2', Math.round(analysisResults.structural.reaction2).toLocaleString(), 'kg'],
                ['Desbalance', analysisResults.structural.balanceQuality.toFixed(1), '%']
            ];

            yPos = drawTable(doc, structData, margin, yPos, contentWidth, primaryColor, 4.5);
            return yPos + 6;
        }

        function drawTable(doc, data, x, y, width, headerColor, rowHeight = 6) {
            const colWidth = width / data[0].length;
            
            // Header
            doc.setFillColor(...headerColor);
            doc.rect(x, y, width, rowHeight, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(8);
            
            for (let j = 0; j < data[0].length; j++) {
                doc.text(data[0][j], x + j * colWidth + 1, y + rowHeight - 1.5);
            }
            
            y += rowHeight;
            
            // Rows
            doc.setTextColor(0, 0, 0);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(7);
            
            for (let i = 1; i < data.length; i++) {
                if (i % 2 === 0) {
                    doc.setFillColor(248, 249, 250);
                    doc.rect(x, y, width, rowHeight, 'F');
                }
                
                for (let j = 0; j < data[i].length; j++) {
                    doc.text(data[i][j].toString(), x + j * colWidth + 1, y + rowHeight - 1.5);
                }
                y += rowHeight;
            }
            
            // Border
            doc.setDrawColor(149, 165, 166);
            doc.setLineWidth(0.3);
            doc.rect(x, y - data.length * rowHeight, width, data.length * rowHeight);
            
            return y;
        }

        function generateProfessionalExcel() {
            // Verificar que hay datos
            if (!analysisResults.crane && !analysisResults.sling && !analysisResults.structural && !analysisResults.stability) {
                alert('‚ö†Ô∏è Debe realizar al menos un an√°lisis antes de exportar a Excel.');
                return;
            }

            // Trackear exportaci√≥n Excel
            trackExport('professional_report', 'Excel');

            // Crear datos para Excel
            let excelData = [];
            let currentRow = 0;

            // Header
            excelData[currentRow++] = ['REPORTE T√âCNICO DE OPERACI√ìN DE IZAJE'];
            excelData[currentRow++] = ['Sistema de C√°lculos de Izaje - Miner√≠a Norte Chile'];
            excelData[currentRow++] = ['Certificado ISO 9001:2015 | Normativas DS 132, ANSI B30, ISO 4301'];
            excelData[currentRow++] = ['Desarrollado por: RaulPivetA. | ¬© 2025'];
            excelData[currentRow++] = [''];

            // Informaci√≥n del proyecto
            excelData[currentRow++] = ['INFORMACI√ìN DEL PROYECTO'];
            excelData[currentRow++] = ['Proyecto:', document.getElementById('projectName').value || 'Proyecto de Izaje'];
            excelData[currentRow++] = ['Empresa:', document.getElementById('companyName').value || 'Empresa Minera'];
            excelData[currentRow++] = ['Ingeniero:', document.getElementById('engineerName').value || 'Ingeniero Responsable'];
            excelData[currentRow++] = ['Fecha Operaci√≥n:', document.getElementById('operationDate').value || new Date().toISOString().split('T')[0]];
            excelData[currentRow++] = ['Reporte Generado:', new Date().toLocaleString('es-ES')];
            excelData[currentRow++] = [''];

            // Datos de cada an√°lisis
            if (analysisResults.crane) {
                excelData[currentRow++] = ['AN√ÅLISIS DE GR√öA'];
                excelData[currentRow++] = ['Par√°metro', 'Valor', 'Unidad'];
                excelData[currentRow++] = ['Peso de Carga', analysisResults.crane.loadWeight, 'kg'];
                excelData[currentRow++] = ['Radio de Operaci√≥n', analysisResults.crane.radius, 'm'];
                excelData[currentRow++] = ['Capacidad Nominal', analysisResults.crane.capacity, 'kg'];
                excelData[currentRow++] = ['Capacidad Efectiva', Math.round(analysisResults.crane.effectiveCapacity), 'kg'];
                excelData[currentRow++] = ['Capacidad Requerida', Math.round(analysisResults.crane.requiredCapacity), 'kg'];
                excelData[currentRow++] = ['Utilizaci√≥n (%)', analysisResults.crane.utilizationPercentage.toFixed(1), '%'];
                excelData[currentRow++] = ['Factor de Seguridad', analysisResults.crane.safetyFactor, '-'];
                excelData[currentRow++] = ['Estado de Seguridad', analysisResults.crane.safetyStatus, '-'];
                excelData[currentRow++] = [''];
            }

            if (analysisResults.sling) {
                excelData[currentRow++] = ['AN√ÅLISIS DE ESLINGAS'];
                excelData[currentRow++] = ['Par√°metro', 'Valor', 'Unidad'];
                excelData[currentRow++] = ['Peso Total', analysisResults.sling.weight, 'kg'];
                excelData[currentRow++] = ['N√∫mero de Ramales', analysisResults.sling.legs, '-'];
                excelData[currentRow++] = ['√Ångulo', analysisResults.sling.angle, '¬∞'];
                excelData[currentRow++] = ['Di√°metro', analysisResults.sling.diameter, 'mm'];
                excelData[currentRow++] = ['Tensi√≥n por Ramal', Math.round(analysisResults.sling.tensionPerLeg), 'kg'];
                excelData[currentRow++] = ['Capacidad de Trabajo', Math.round(analysisResults.sling.workingLoad), 'kg'];
                excelData[currentRow++] = ['Utilizaci√≥n (%)', analysisResults.sling.utilizationSling.toFixed(1), '%'];
                excelData[currentRow++] = ['Estado de Seguridad', analysisResults.sling.slingStatus, '-'];
                excelData[currentRow++] = [''];
            }

            if (analysisResults.structural) {
                excelData[currentRow++] = ['AN√ÅLISIS ESTRUCTURAL'];
                excelData[currentRow++] = ['Par√°metro', 'Valor', 'Unidad'];
                excelData[currentRow++] = ['Longitud Total', analysisResults.structural.totalLength, 'm'];
                excelData[currentRow++] = ['Peso Total', analysisResults.structural.totalWeight, 'kg'];
                excelData[currentRow++] = ['Centro de Gravedad', analysisResults.structural.centerOfGravity.toFixed(3), 'm'];
                excelData[currentRow++] = ['Punto de Izaje 1', analysisResults.structural.liftPoint1.toFixed(3), 'm'];
                excelData[currentRow++] = ['Punto de Izaje 2', analysisResults.structural.liftPoint2.toFixed(3), 'm'];
                excelData[currentRow++] = ['Reacci√≥n 1', Math.round(analysisResults.structural.reaction1), 'kg'];
                excelData[currentRow++] = ['Reacci√≥n 2', Math.round(analysisResults.structural.reaction2), 'kg'];
                excelData[currentRow++] = ['Desbalance (%)', analysisResults.structural.balanceQuality.toFixed(1), '%'];
                excelData[currentRow++] = ['Estado de Seguridad', analysisResults.structural.structuralStatus, '-'];
                excelData[currentRow++] = [''];
            }

            if (analysisResults.stability) {
                excelData[currentRow++] = ['AN√ÅLISIS DE ESTABILIDAD'];
                excelData[currentRow++] = ['Par√°metro', 'Valor', 'Unidad'];
                excelData[currentRow++] = ['Base de Apoyo', analysisResults.stability.base, 'm'];
                excelData[currentRow++] = ['Peso de Gr√∫a', analysisResults.stability.craneWeight, 'kg'];
                excelData[currentRow++] = ['Velocidad de Viento', analysisResults.stability.windSpeed, 'km/h'];
                excelData[currentRow++] = ['Factor de Estabilidad', analysisResults.stability.stabilityFactor.toFixed(2), '-'];
                excelData[currentRow++] = ['Estado de Seguridad', analysisResults.stability.stabilityStatus, '-'];
                excelData[currentRow++] = [''];
            }

            // Convertir a CSV mejorado
            let csvContent = '';
            excelData.forEach(row => {
                csvContent += row.map(cell => {
                    if (typeof cell === 'string' && (cell.includes(',') || cell.includes('"') || cell.includes('\n'))) {
                        return '"' + cell.replace(/"/g, '""') + '"';
                    }
                    return cell || '';
                }).join(',') + '\n';
            });

            // Crear y descargar archivo
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            
            const fileName = 'Reporte_Izaje_' + 
                (document.getElementById('projectName').value || 'Proyecto').replace(/\s+/g, '_') + 
                '_' + new Date().toISOString().split('T')[0] + '.csv';
                
            link.setAttribute('download', fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            // Trackear √©xito
            trackEvent('export_success', 'Excel_Export', fileName);

            alert('‚úÖ Datos exportados a Excel (CSV)!\n\n' + 
                'Archivo: ' + fileName + '\n' +
                'El archivo se ha descargado y puede abrirse en Excel, LibreOffice Calc, o Google Sheets.\n\n' +
                'Desarrollado por: RaulPivetA.');
        }

        // Configurar fecha actual por defecto
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('operationDate').value = today;
            
            // Trackear inicio de sesi√≥n
            trackEvent('session_start', 'User_Engagement', 'Application_Loaded');
        });

        // Trackear antes de cerrar la p√°gina
        window.addEventListener('beforeunload', function() {
            trackEvent('session_end', 'User_Engagement', 'Application_Closed');
        });

        // Funciones de utilidad para mejor UX
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = '<div class="alert alert-warning">' +
                    '<span class="alert-icon"><div class="loading"></div></span>' +
                    '<div><strong>Procesando...</strong><br>Por favor espere mientras se realiza el c√°lculo.</div>' +
                '</div>';
            }
        }

        function hideLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element && element.innerHTML.includes('loading')) {
                element.innerHTML = '';
            }
        }

        // Validaci√≥n en tiempo real
        function validateInput(inputElement, min, max, message) {
            const value = parseFloat(inputElement.value);
            if (value < min || value > max) {
                inputElement.setCustomValidity(message);
                inputElement.style.borderColor = '#e74c3c';
            } else {
                inputElement.setCustomValidity('');
                inputElement.style.borderColor = '#e9ecef';
            }
        }

        // Agregar validaciones a inputs cr√≠ticos
        document.addEventListener('DOMContentLoaded', function() {
            const craneLoadWeight = document.getElementById('craneLoadWeight');
            const slingAngleInput = document.getElementById('slingAngleInput');
            
            if (craneLoadWeight) {
                craneLoadWeight.addEventListener('input', function() {
                    validateInput(this, 1, 1000000, 'El peso debe estar entre 1 kg y 1,000,000 kg');
                });
            }
            
            if (slingAngleInput) {
                slingAngleInput.addEventListener('input', function() {
                    validateInput(this, 15, 90, 'El √°ngulo debe estar entre 15¬∞ y 90¬∞');
                });
            }
        });
    </script>
</body>
</html>